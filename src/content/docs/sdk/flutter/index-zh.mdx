---
title: "开始使用"
description: "Use the Flutter SDK to access Adjust's features in your Flutter apps"
category-title: "Flutter SDK"
slug: "zh/sdk/flutter"
sidebar-position: 5
---

The Adjust Flutter SDK enables you to measure attribution, events, and much more in your Flutter app. Follow the steps in this guide to set up your app to work with the Adjust SDK. You can also check out the example apps [on GitHub](https://github.com/adjust/flutter_sdk/tree/master/example).

<Callout type="important">

Adjust SDK 支持 iOS 9 或更新版本，以及安卓 API 级别 9 \(Gingerbread\) 或更新版本。

</Callout>

## 1\. Add the SDK to your project

要在您的 Flutter 应用中使用 [Adjust Flutter SDK](https://github.com/adjust/flutter_sdk/releases)，请先将 SDK 加入项目。

如需将 Adjust SDK 集成到您的 Flutter 项目中，请按照以下步骤操作：

1. 添加下列行至您的 `pubspec.yaml` 文件:

```yaml
dependencies:
   adjust_sdk: ^$FLUTTER_VERSION
```

2. 找到您的项目并运行以下指令。编辑 `pubspec.yaml` 文件后，Visual Studio 会自动运行该命令。

```console
$ flutter packages get
```

## 2\. Set up Android devices

### 添加 Google Play 服务

针对 Google Play 商店的应用必须使用 [Google 广告 ID](https://support.google.com/googleplay/android-developer/answer/6048248?hl=en) \(`gps_adid`\) 来识别设备。为此，请将以下 dependency 加入`build.gradle` 文件的 `dependencies` 部分。

```groovy
implementation 'com.google.android.gms:play-services-ads-identifier:18.0.1'
```

<Callout type="note">

The Adjust SDK isn't tied to any version of the `play-services-ads-identifier` dependency. You can use the any version of the Google Play Services library.

</Callout>

### 添加权限

The Adjust SDK requires the following permissions. Add them to your `AndroidManifest.xml` file if they're not already present:

```xml
<uses-permission android:name="android.permission.INTERNET" id="sl-md0000000"/>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" id="sl-md0000000"/>
```

The Adjust SDK includes the `com.google.android.gms.AD_ID` permission by default in version 4\.32\.0 and above. You can remove it by adding a `remove` directive if need to make your app COPPA\-compliant or if you don't target the Google Play Store.

```xml
<uses-permission android:name="com.google.android.gms.permission.AD_ID" tools:node="remove" id="sl-md0000000"/>
```

<Callout type="seealso">

See Google's [`AdvertisingIdClient.Info documentation`](https://developers.google.com/android/reference/com/google/android/gms/ads/identifier/AdvertisingIdClient.Info#public-string-getid) for more information about this permission.

</Callout>

### 设置 Proguard

如果您使用的是 Proguard，请将这些规则添加至您的[自定义 Proguard 文件](https://docs.unity3d.com/Manual/class-PlayerSettingsAndroid.html#build)。

```java
-keep public class com.adjust.sdk.** { *; }
-keep class com.google.android.gms.common.ConnectionResult {
   int SUCCESS;
}
-keep class com.google.android.gms.ads.identifier.AdvertisingIdClient {
   com.google.android.gms.ads.identifier.AdvertisingIdClient$Info getAdvertisingIdInfo(android.content.Context);
}
-keep class com.google.android.gms.ads.identifier.AdvertisingIdClient$Info {
   java.lang.String getId();
   boolean isLimitAdTrackingEnabled();
}
-keep public class com.android.installreferrer.** { *; }
```

If you aren't publishing your app in the Google Play Store, add the following rule to your Proguard file.

```java
-keep public class com.adjust.sdk.** { *; }
```

### 设置 Install Referrer

Install Referrer 是一种唯一标识符，可用来将应用安装归因至来源。Adjust SDK 需要该信息进行归因。您可以用下列 3 种方法收集 install referrer：

-  使用 [Google Play Referrer API](https://developer.android.com/google/play/installreferrer)。
-  使用华为 Referrer API \(仅限华为设备\)。

<Callout type="important">

[Google 已不再针对 Google Play 服务使用`INSTALL_REFERRER` intent 方法](https://android-developers.googleblog.com/2019/11/still-using-installbroadcast-switch-to.html)传递 referrer 信息。如果您当前在使用这种方法，请迁移至 Google Play Referrer API。

</Callout>

#### Google Play Referrer API

要支持 Google Play Referrer API，请将下列行添加进您的 `build.gradle` 文件

```groovy
implementation 'com.android.installreferrer:installreferrer:2.2'
```

如果您使用的是 Proguard，请务必将下列设置加入您的 Proguard 文件：

```java
-keep public class com.android.installreferrer.** { *; }
```

#### 华为 Referrer API

<MinorVersion added="v4.22.0">

As of v4\.22\.0, the Adjust SDK supports install tracking on Huawei devices using Huawei App Gallery v10\.4 and later. You don't need to make any changes to start using the Huawei Referrer API.

</MinorVersion>

#### Meta referrer 集成

<Callout type="note">

Adjust SDK 会捆绑[Meta 要求](https://developers.facebook.com/docs/app-ads/meta-install-referrer#step-1--add-the-meta-apps)的`<queries id="sl-md0000000">`元素。您无需将这些元素添加至`AndroidManifest.xml`。

</Callout>

<MinorVersion added="v4.36.0">

Adjust SDK v4\.36\.0 及更高版本支持[Meta Install Referrer](https://developers.facebook.com/docs/app-ads/meta-install-referrer)。要启用该功能：

</MinorVersion>

1. 在[应用控制面板](https://developers.facebook.com/apps)中找到您的 Meta app ID。更多信息，请参考 Meta 的[应用控制面板文档](https://developers.facebook.com/docs/development/create-an-app/app-dashboard)。

2. 在`AdjustConfig`实例上将您的 App ID 指定至`fbAppId`属性。

   ```dart
   AdjustConfig config = new AdjustConfig('{YourAppToken}', AdjustEnvironment.sandbox);
   config.fbAppId = "<fb_app_id_string id="sl-md0000000">";
   ```

## 3\. Add iOS frameworks

The Adjust SDK is able to get extra information when you include certain iOS frameworks in your app. These frameworks enable certain SDK features, but they're not mandatory for the SDK to work normally. You can add the frameworks and then mark them as optional in **Project Settings \-\-> Build Phases \-\-> Link Binary With Libraries** .

<Table>

| 框架                                | 描述                                                                                                                                  | 注意事项                                                                                                     |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| `AdSupport.framework`               | Enables access to the device's IDFA. Also enables access to LAT information on devices running iOS 14 or earlier                      | Don't add this framework if your app targets the "Kids" category                                             |
| `AdServices.framework`              | Handles Apple Search Ads attribution                                                                                                  |                                                                                                              |
| `StoreKit.framework`                | Enables access to the SKAdNetwork framework                                                                                           | Required to allow the Adjust SDK to handle communication with SKAdNetwork on devices running iOS 14 or later |
| `AppTrackingTransparency.framework` | Required to allow the Adjust SDK to wrap user tracking consent dialog and access consent responses on devices running iOS 14 or later | Don't add this framework if your app targets the "Kids" category                                             |

</Table>

## 4\. Initialize the Adjust SDK

请确保在 Flutter 应用中尽快初始化 Adjust SDK。要进行 SDK 初始化，请使用应用识别码及您希望应用程序运行的环境来初始化 config 对象。

<Callout type="important">

在进行测试时，应当确保将环境设置为 `AdjustEnvironment.sandbox` 。请在向 App Store 提交应用程序前将此设为 `AdjustEnvironment.production` 。

</Callout>

```dart
AdjustConfig config = new AdjustConfig('{YourAppToken}', AdjustEnvironment.sandbox);
Adjust.start(config);
```

## 5\. Set up session tracking

You need to set up session tracking so that the SDK can pass session information to the Adjust server.

<Callout type="note">

Session tracking for iOS devices is supported by default.

</Callout>

To set up session tracking for Android devices, call the `Adjust.onResume()` method when the app is running in the foreground and make a call to the `Adjust.onPause()` method when the app isn't running in the foreground. You can do this globally or per widget.

```dart
class AdjustExampleApp extends StatelessWidget {
   @override
   Widget build(BuildContext context) {
      return new MaterialApp(
         title: 'Adjust Flutter Example App',
         home: new MainScreen(),
      );
   }
}

class MainScreen extends StatefulWidget {
   @override
   State createState() => new MainScreenState();
}

class MainScreenState extends State<mainscreen id="sl-md0000000"> with WidgetsBindingObserver {
   @override
   initState() {
      super.initState();
      WidgetsBinding.instance.addObserver(this);
      initPlatformState(); // <-- Initialise SDK in here.
   }

   @override
   void dispose() {
      WidgetsBinding.instance.removeObserver(this);
      super.dispose();
   }

   @override
   void didChangeAppLifecycleState(AppLifecycleState state) {
      switch (state) {
         case AppLifecycleState.inactive:
            break;
         case AppLifecycleState.resumed:
            Adjust.onResume();
               break;
         case AppLifecycleState.paused:
            Adjust.onPause();
               break;
         case AppLifecycleState.suspending:
            break;
   }
   }
}
```

## 6\. Build your app

Well done\! You should now be able to build and run your Flutter app. Enable logging to check for any issues. Check your logs to see the `Install tracked` message.

您现在已经准备就绪，可以使用 Adjust SDK 进行用户归因了。

## 7\. Add the Adjust SDK signature

You can use the Adjust SDK signature to sign all communications sent by the Adjust SDK. This enables Adjust’s servers to detect and reject any install activity that's not legitimate.

要开始使用 Adjust SDK 签名，请联系您的技术客户经理，或发送邮件至 [support@adjust.com](mailto:support@adjust.com)。

## 8\. Test your integration

采用 Adjust SDK 提供的工具，您可以测试并排除集成出现的问题。要测试集成，请按照下列步骤操作：

-  将环境设为 **Sandbox** 。
-  Add a sandbox filter to your Adjust dashboard results.
-  Set your log level to **verbose** .

<Callout type="tip">

如果遇到任何问题，请发送邮件至 [support@adjust.com](mailto:support@adjust.com)，并在邮件中说明所有详情和日志。

</Callout>

### 测试 Google Play 服务集成

To test that the Adjust SDK can receive a device's Google Advertising ID, set the log level to **verbose** and the environment to **Sandbox** . Start your app and measure a session or an event. The SDK logs the `gps_adid` \(Google Play Services Advertiser ID\) parameter if it has read the advertising ID.

If you're experiencing issues retrieving the Google Advertising ID, open an issue in the SDK [GitHub repository](https://github.com/adjust/flutter_sdk) or contact [support@adjust.com](mailto:support@adjust.com).
