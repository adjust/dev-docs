---
title: "Facebookピクセルと連携"
description: "Facebookピクセルプラグインを使用して、AdjustにFacebookピクセル情報をパスします。"
slug: "ja/sdk/ios/plugins/facebook-pixel"
---

A [Facebook pixel](https://www.facebook.com/business/help/952192354843755?id=1205376682832142) is a web\-only analytics tool from Facebook. As of v4\.34 of the Facebook SDK, you can record pixel events in an app's webview. You can also convert Facebook Pixel events into Facebook App events. To do this, use Hybrid Mobile App Events.

また、Facebook SDKを実装しなくても、Adjust SDKでFacebookピクセルを利用できるようになりました。

## [サンプルアプリ](example-app)

-  [iOSサンプルアプリ](https://github.com/adjust/ios_sdk/tree/master/examples/AdjustExample-FbPixel)

## [Facebookとの連携](facebook-integration)

### [FacebookアプリID](facebook-app-id)

Facebookピクセルの使用を開始するには、次の手順を実行します。

[FacebookのiOS SDKガイド](https://developers.facebook.com/docs/ios/getting-started/#xcode)の説明のとおり、次の手順を実行してFacebookアプリIDをアプリに追加する必要があります。

1. Xcodeで、プロジェクトの`Info.plist`ファイルを右クリックして、 **Open As \-> Source Code** を選択します。
2. 以下のXMLスニペットをファイルbodyの最後の`</dict>`要素の直前に挿入します。

<CodeBlock title="Info.plist">

```xml
<dict id="sl-md0000000">
  <key id="sl-md0000000">FacebookAppID</key>
  <string id="sl-md0000000">{your-app-id}</string>
</dict>

```

</CodeBlock>

`{your-app-id}`を対象アプリのアプリIDに置き換えます。これはFacebook App Dashboardで確認できます。

### [Facebookピクセルの設定](facebook-pixel-configuration)

Facebook Pixelの統合方法については、Facebookのガイドに従ってください。Javascriptコードは以下のように記述する必要があります。

```html
<!-- Facebook Pixel Code -->
<script id="sl-md0000000">
   !function(f,b,e,v,n,t,s)
   fbq('init', <YOUR_PIXEL_ID>);
   fbq('track', 'PageView');
</script>
<!-- End Facebook Pixel Code -->
```

次に、Facebookピクセルコードを更新します。手順は[Hybrid Mobile App Eventsガイド](https://developers.facebook.com/docs/app-events/hybrid-app-events)の **Update Your Pixel** に記載されています。

```js
fbq('init', <your_pixel_id id="sl-md0000000">);
fbq('set', 'mobileBridge', <your_pixel_id id="sl-md0000000">, <your_fb_app_id id="sl-md0000000">);
```

<Callout type="important">

You need to call `init` and then set immediately afterward. The snippet provided by Facebook contains a `track` method. You can use this method to record a page view event right after you call the `init` method. To record the view event, you need to call `set` between `init` and `track`.

</Callout>

## [Adjust SDKの実装](adjust-sdk-integration)

### [web viewの拡張](augment-the-web-view)

iOS web viewアプリの連携ガイドに従ってください。Web View bridgeをロードする際に、 `augmentHybridWebView`メソッドへの呼び出しを追加します。

```objc
- (void)viewWillAppear:(BOOL)animated {
    UIWebView *webView = [[UIWebView alloc] initWithFrame:self.view.bounds];
    /// or with WKWebView:
    /// WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.bounds];

    /// add @property (nonatomic, strong) AdjustBridge *adjustBridge; on your interface
    self.adjustBridge = [[AdjustBridge alloc] init];
    [self.adjustBridge loadUIWebViewBridge:webView];
    /// optionally you can add a web view delegate so that you can also capture its events
    /// [self.adjustBridge loadUIWebViewBridge:webView webViewDelegate:(UIWebViewDelegate*)self];

    /// or with WKWebView:
    /// [self.adjustBridge loadWKWebViewBridge:webView];
    /// optionally you can add a web view delegate so that you can also capture its events
    /// [self.adjustBridge loadWKWebViewBridge:webView wkWebViewDelegate:(id<wknavigationdelegate id="sl-md0000000">)self];
    [self.adjustBridge augmentHybridWebView];
```

### [イベント名の登録](event-name-registration)

Adjust web bridge SDKは、Facebook PixelイベントをAdjustイベントに変換します。

To use this feature, you need to map Facebook pixels to specific Adjust events. You can also configure a default Adjust event token. To use a default token, you need to add the token before starting the Adjust SDK and recording any pixel event. This includes the copy\-pasted `fbq('track', 'PageView');` event from the Facebook pixel configuration.

イベントをマッピングするには、configインスタンスで`addFbPixelMapping`メソッドを呼び出します。 Facebookイベント名とAdjustイベントトークンをパラメーターとして使用してください。Adjust SDKを初期化する前にこれを呼び出す必要があります。

```js
adjustConfig.addFbPixelMapping("fb_mobile_search", adjustEventTokenForSearch);
adjustConfig.addFbPixelMapping(
   "fb_mobile_purchase",
   adjustEventTokenForPurchase,
);
```

<Callout type="note">

上記の例は、`fbq('track', 'Search')`と`fbq('track', 'Purchase')`を計測する場合に対応しています。Adjustは、Facebook SDKとJavascriptイベント間の完全なマッピングにはアクセスできません。

</Callout>
<Table>

| ピクセルイベント名            | Facebookアプリのイベント名        |
| ----------------------------- | --------------------------------- |
| ViewContent                   | `fb_mobile_content_view`          |
| 検索ネットワーク キャンペーン | `fb_mobile_search`                |
| AddtoCart                     | `fb_mobile_add_to_cart`           |
| AddToWishlist                 | `fb_mobile_add_to_wishlistt`      |
| InitiateCheckout              | `fb_mobile_initiated_checkout`    |
| AddPaymentInfo                | `fb_mobile_add_payment_info`      |
| 購入                          | `fb_mobile_purchase`              |
| CompleteRegistration          | `fb_mobile_complete_registration` |

</Table>

Adjust SDKでは、特定のイベントについてデフォルトのイベントトークンが見つからない場合は、警告をログに記録します。

```text
There is not a default event token configured or a mapping found for event named: 'fb_mobile_search'. It won't be measured as an adjust event.
```

マッピングを設定していない場合は、デフォルトのAdjustイベントを設定することも可能です。これを行うには、Adjust SDKを初期化する前に`adjustConfig.setFbPixelDefaultEventToken(defaultEventToken);`を呼び出します。
