---
title: "ディープリンクをテストする"
description: "ディープリンクをテストし、想定どおりに機能することを確認します。"
slug: "ja/sdk/ios/features/deep-links/testing"
sidebar-position: 6
---

マーケティングチームがキャンペーンでディープリンクを実際に使用する前に、テストを行なっていただくことが重要です。テストでは、以下のことを確認してください：

-  ディープリンクが正しく設定されていること。
-  意図したコンテンツにユーザーを誘導すること。
-  Adjustで記録されていること。

## [事前準備](before-you-begin)

はじめに、以下の設定を行なってください。

1. アプリ環境を`ADJEnvironmentSandbox`に設定し、ログレベルを`ADJLogLevelVerbose`に設定します。

2. Xcodeでアプリをビルドして実行します。

3. サンプルのディープリンクをマーケティングチームから入手します。

   例： `https://example.go.link/summer-clothes?promo=beach`

## [テストリンクを作成する](create-a-test-link)

ディープリンクの実装をテストするには、テストリンクを作成する必要があります。これを行うには、以下の手順に従ってください。

1. Adjustにログインします。
2. **Campaign Lab** で、 **カスタムリンク（Custom Links）** を選択します。
3. **新規リンク（New link）** を選択します。
4. **アプリの選択（App selection）** 画面で、リンクを作成したいアプリを選択します。
5. **リンク構造（Link structure）** 画面で、トップレベルのチャネルリンクの名前を追加します。 必要に応じて、キャンペーン、アドグループ、クリエイティブのサブレベルを追加してリンク構造を設定します。
6. ユーザーの **遷移先（User destinations）** 画面で、以下の情報を入力すると、ディープリンクがリンクに追加されます。

   -  iOSアプリスキーム \(iOS App Schema\)
   -  iOSのアプリ画面

7. **アトリビューション設定（Attribution settings）** 画面で、 **新規ユーザー：アトリビューション（attribution）\-\-> クリック（Clicks）** の下にある **確率的モデリング（probabilistic modeling）** を **ON** にします。
8. **リンクの確認（Link review）** 画面で内容を確認し、必要に応じて変更します。
9. **リンクの作成（Create link）** を選択し、クリックURL、QRコード、リンクトークンを選択します。

例： `https://example.go.link/summer-clothes?promo=beach&adj_t=abc123`

## [ダイレクトディープリンクのテスト](test-direct-deep-linking)

次のユニバーサルリンク設定をテストしてください。

-  Adjustユニバーサルリンク
-  メールリダイレクトおよびURL短縮ユニバーサルリンク

### [ユニバーサルリンクドメインの設定を確認する](check-universal-link-domain-configuration)

<Callout type="important">

iOSでは、ユニバーサルリンクをブラウザーに直接入力しても、ディープリンクとして開かれません。ユニバーサルリンクはハイパーリンクとしてクリックされる必要があります。

</Callout>

ユニバーサルリンクドメインの設定を確認するには、次の手順に従ってください。

1. iOSテストデバイスで、ユニバーサルリンクをAppleメモ（Notes ）にペーストします。
2. Appleメモで、ユニバーサルリンクを長押しし、iOSメニューを開きます。 **アプリで開く（Open in your app）** オプションが表示されている場合、iOSはアプリとドメインの間で接続を確立できています。

このオプションが表示されない場合は、次の問題を確認してください。

### [Adjustユニバーサルリンク](adjust-universal-links)

-  マーケティングチームがAdjustダッシュボードでAdjustユニバーサルリンクを有効にしていることを確認します。
-  Xcodeで **Associated Domains** の設定を確認します。

   -  `applinks: prefix`が存在している必要があります。
   -  Xcodeでのドメインが、AdjustダッシュボードのAdjust **ユニバーサルリンクドメイン** または **ブランドリンク** と一致している必要があります。異なるビルドをテストしている場合（例：デバッグとリリース比較）、全てのビルドでAdjustユニバーサルリンクのドメインまたはブランドリンクを追加することが可能です。

-  アプリでの次の値がAdjustダッシュボードでの値と一致しているかどうかを確認します。
   -  **App ID prefix**
   -  **バンドルID** ：デバッグビルドまたはリリースビルドのバンドルIDを使用しているかどうかを確認します。

### [メールリダイレクトおよびURL短縮ユニバーサルリンク](email-redirect-and-url-shortener-universal-links)

-  XcodeでAssociated Domainsの設定を確認します。

   -  `applinks: prefix`が存在している必要があります。
   -  Xcodeでのドメインが、パートナーのシステムで設定されているメールリダイレクトドメインまたはURL短縮ドメインと一致している必要があります。

-  アプリでの次の値が、パートナーのシステムのメールリダイレクトドメインまたはURL短縮ドメインのAASA（Apple\-App\-Site\-Association）ファイルでの値と一致しているかどうかを確認します。
   -  **App ID prefix**
   -  **バンドルID** ：デバッグビルドまたはリリースビルドのバンドルIDを使用しているかどうかを確認します。
   -  メールリダイレクトドメイン/URL短縮ドメイン \- メールパートナーのシステムでドメインをカスタムドメインとして設定しているかどうかを確認します。

### [アプリでダイレクトディープリンクをテストする](test-direct-deep-linking-in-the-app)

テストデバイスでアプリが閉じている時と、バックグラウンドで動作している時の両方で、ダイレクトディープリンクをテストしてください。

#### [アプリが閉じている時](app-closed)

1. ユニバーサルリンクをAppleメモ（Notes ）にコピペします。
2. ホームボタンを2度タップします。アプリが開いている時は、アプリを上にスワイプして閉じます。
3. Appleメモを開きます。
4. ユニバーサルリンクをクリックします。

アプリが開き、ディープリンクのコンテンツが表示されるはずです。アプリに正しいページが表示されない場合は、以下を確認してください：

-  ディープリンクのパスまたはパラメーターが正しいことを確認します。`&`記号の代わりに`?`記号を2回使用しているかどうかを確認します。
-  アプリで次のメソッドを介してディープリンクを処理しているかどうかを確認します。

   -  **アプリでシーンを使用しない場合** ：`application(_:continue:restorationHandler:)`メソッド
   -  **アプリでシーンを使用する場合** ：`scene(_:continue:)`メソッド

-  コード内の他のコンテンツがディープリンクに干渉していないかどうかを確認する。
-  ユニバーサルリンクへのリダイレクトを設定している場合、リダイレクトを正しく設定していることを確認します。
-  リンク解析メソッドを正しく設定しているかどうかを確認します。メールリダイレクトドメインまたはURL短縮ドメインを`resolveUrlSuffixArray`に追加していることを確認します。

ディープリンクを選択した後、アプリでAdjust SDKのappWillOpenメソッドが呼び出されます。Xcodeのログに次のようなエントリがあることを確認してください。

```text
2022-09-28 09:19:30.873598+0900 example[1619:241845]  [Adjust]d: Added sdk_click 1
2022-09-28 09:19:30.873782+0900 example[1619:241845]  [Adjust]v: Path:      /sdk_click
2022-09-28 09:19:30.873806+0900 example[1619:241845]  [Adjust]v: ClientSdk: ios$IOS_V4_VERSION
2022-09-28 09:19:30.873824+0900 example[1619:241845]  [Adjust]v: Parameters:
[...]
2022-03-15 09:19:30.873956+0900 example[1619:241845]  [Adjust]v: source   deeplink
```

Xcodeのログにこれらのエントリが見つからない場合は、次のことを確認してください。

-  Adjust SDKで環境を`sandbox`に、ログを`verbose`に設定している。

   -  Xcodeのログで、詳細ログは`[Adjust]v`で判別できます。

-  ディープリンクを受け取るメソッドで、アプリが`appWillOpenUrl`メソッドを呼び出している。

#### [アプリがバックグラウンドで動作している時](app-running-in-background)

1. ユニバーサルリンクをAppleメモ（Notes ）にコピペします。
2. ホームボタンをタップします。
3. アプリアイコンでアプリを開きます。
4. ホームボタンを2度タップし、Appleメモを開きます。
5. ユニバーサルリンクをクリックします。

アプリでディープリンクのコンテンツが表示されることを確認します。アプリに正しいページが表示されない場合は、以下を確認してください：

-  アプリで次のメソッドを介してディープリンクを処理しているかどうかを確認します。
   -  **アプリでシーンを使用しない場合** ：`application(_:continue:restorationHandler:)`メソッド
   -  **アプリでシーンを使用する場合** ：`scene(_:continue:)`メソッド

ディープリンクを選択した後、アプリでAdjust SDKの`appWillOpenUrl`メソッドが呼び出されます。Xcodeのログに次のようなエントリがあることを確認してください。

```text
2022-09-28 09:19:30.873598+0900 example[1619:241845]  [Adjust]d: Added sdk_click 1
2022-09-28 09:19:30.873782+0900 example[1619:241845]  [Adjust]v: Path:      /sdk_click
2022-09-28 09:19:30.873806+0900 example[1619:241845]  [Adjust]v: ClientSdk: ios$IOS_V4_VERSION
2022-09-28 09:19:30.873824+0900 example[1619:241845]  [Adjust]v: Parameters:
[...]
2022-03-15 09:19:30.873956+0900 example[1619:241845]  [Adjust]v: source   deeplink
```

Xcodeのログにこれらのエントリが見つからない場合は、次のことを確認してください。

-  Adjust SDKで環境を`ADJEnvironmentSandbox`に、ログを`ADJLogLevelVerbose`に設定している。

   -  Xcodeのログで、詳細ログは`[Adjust]v`で判別できます。

-  ディープリンクを受け取るメソッドで、アプリが`appWillOpenUrl`メソッドを呼び出している。

## [カスタムURLスキームを使用したダイレクトディープリンクのテスト](test-direct-deep-linking-with-a-custom-url-scheme)

テストデバイスでアプリが閉じているか、またはバックグラウンドで動作しているときに、カスタムURLスキームを使用したダイレクトディープリンクをテストできます。

Appleメモで、ユニバーサルリンクを選択します。アプリが開いてディープリンクコンテンツが表示されることを確認します。

アプリが開かない場合は、次のことを確認してください。

-  XcodeでURLスキームを正しく設定している。
-  アプリのデバッグビルドをテストしている場合は、デバッグまたはリリースのカスタムURLスキームを使用しているかどうかを確認。

アプリに正しいページが表示されない場合は、以下を確認してください：

-  ディープリンクのパスまたはパラメーターが正しいことを確認します。`&`記号の代わりに`?`記号を2回使用しているかどうかを確認します。
-  アプリで次のメソッドを介してディープリンクを処理しているかどうかを確認します。

   -  **アプリでシーンを使用しない場合** ：`application(_:continue:restorationHandler:)`メソッド
   -  **アプリでシーンを使用する場合** ：`scene(_:continue:)`メソッド

-  コード内の他のコンテンツがディープリンクに干渉していないかどうかを確認する。

ディープリンクを選択した後、アプリでAdjust SDKの`appWillOpenUrl`メソッドが呼び出されます。Xcodeのログに次のようなエントリがあることを確認してください。

```text
2022-09-28 09:19:30.873598+0900 example[1619:241845]  [Adjust]d: Added sdk_click 1
2022-09-28 09:19:30.873782+0900 example[1619:241845]  [Adjust]v: Path:      /sdk_click
2022-09-28 09:19:30.873806+0900 example[1619:241845]  [Adjust]v: ClientSdk: ios$IOS_V4_VERSION
2022-09-28 09:19:30.873824+0900 example[1619:241845]  [Adjust]v: Parameters:
[...]
2022-03-15 09:19:30.873956+0900 example[1619:241845]  [Adjust]v: source   deeplink
```

Xcodeのログにこれらのエントリが見つからない場合は、次のことを確認してください。

-  Adjust SDKで環境を`ADJEnvironmentSandbox`に、ログを`ADJLogLevelVerbose`に設定している。

   -  Xcodeのログで、詳細ログは`[Adjust]v`で判別できます。

-  ディープリンクを受け取るメソッドで、アプリが`appWillOpenUrl`メソッドを呼び出している。

## [ディファードディープリンクのテスト](test-deferred-deep-linking)

テストデバイスでディファードディープリンクをテストするには、以下の手順に従ってください。

1. アプリをインストールします。

2. XcodeのログからADID（AdjustデバイスID）を取得します。例：

   <CodeBlock highlight="adid, 4446ab34861b99b78ee374c3bd38a350">

   ```text
   2022-09-28 09:19:35.609913+0900 example[1619:241847] [Adjust]v: Response: {"app_token":"2eb2na2w54c3","adid":"4446ab34861b99b78ee374c3bd38a350","timestamp":"2022-09-28T00:19:35.841Z+0000","message":"Attribution found","attribution":{"tracker_token":"abc123","tracker_name":"Organic","network":"Organic"}}
   ```

   </CodeBlock>

3. アプリをアンインストールします。

4. [テストコンソール](https://help.adjust.com/ja/article/testing-console)を開き、Adjust ADIDを入力して、 **デバイスデータの表示（View Device Data）** を選択します。`TrackerName`が`Organic`と表示されることを確認してください。

5. テストコンソールを使用して、デバイス情報を削除します。

6. ユニバーサルリンクまたはカスタムURLスキームのディープリンクをAppleメモにペーストします。

7. ディープリンクを選択します。App Storeにリダイレクトされることを確認します。

8. ローカルビルドからアプリをインストールします。ストアからアプリをインストールしないでください。

9. アプリを開きます。このアプリが開いてディープリンクコンテンツが表示されることを確認します。

アプリに正しいページが表示されない場合は、以下を確認してください：

-  コード内の他のコンテンツがディープリンクに干渉していないかどうかを確認する。例：アプリにオンボーディング画面があったり、ユーザーログインが必要な場合でも、ディープリンクを開く前にアプリがこれを処理していない。ディープリンクを処理する前にオンボーディング画面またはユーザーログインを処理するための`adjustDeeplinkResponse`メソッドを実装することが必要な場合があります。
-  アプリのコードが、 `adjustDeeplinkResponse`メソッドで受信するディープリンクを処理していない。
-  Adjustでインストールがクリックにアトリビュートされていなかったかどうか。テストコンソールで、 **デバイスデータの表示（View Device Data）** を選択します。`TrackerName`フィールドにテストリンクが表示されることを確認します。テストを開始する前に、次のことを確認してください。
   -  テストリンクで確率的マッチングが有効化されている。
   -  テストコンソールで、 `TrackerName`が`Organic`に設定されている。
