---
title: "サブスクリプション情報を送信する"
description: "Adjustにサブスクリプション情報を送信するには、これらのメソッドを使用してください。"
slug: "en/sdk/ios/features/subscriptions"
---
<callout type="important"> 

以下の手順は、Adjust SDK内でサブスクリプション計測を行う場合にのみ有効です。この機能を有効化するには、アプリ固有の情報を別途追加する必要があります。設定のサポートをいたしますので、[support@adjust.com](mailto:support@adjust.com)または担当のテクニカルアカウントマネージャーまでお問い合わせください。
</Callout> 

App Storeのサブスクリプションを記録し、それぞれの有効性をAdjust SDKで確認できます。ユーザーがサブスクリプションの購入を完了したら、その詳細を含む`ADJSubscription`インスタンスを作成します。

[1\. サブスクリプションオブジェクトをインスタンス化する](1-instantiate-a-subscription-object)
---------------------------------------------------------------------

```objc
- (nullable id)initWithPrice:(nonnull NSDecimalNumber *)price
                    currency:(nonnull NSString *)currency
               transactionId:(nonnull NSString *)transactionId
                  andReceipt:(nonnull NSData *)receipt;
```

開始するには、サブスクリプション購入の詳細を含むサブスクリプションオブジェクトを作成する必要があります。これを行うには、`initWithPrice`メソッドを使用して`ADJSubscription`オブジェクトを初期化します。さらに、以下の引数をパスします。
<table> 

|     パラメーター      |      データタイプ       |                                                                                                                                説明                                                                                                                                 |
|-----------------|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `price`         | `NSDecimalNumber` | サブスクリプションの価格                                                                                                                                                                                                                                                      |
| `currency`      | `NSString`        | サブスクリプションの通貨。[`priceLocale`](https://developer.apple.com/documentation/foundation/nslocale/1642836-currencycode?language=objc)オブジェクトの[`currencyCode`](https://developer.apple.com/documentation/storekit/skproduct/1506145-pricelocale?language=objc)としてフォーマットされる |
| `transactionId` | `NSString`        | トランザクションID                                                                                                                                                                                                                                                        |
| `receipt`       | `NSString`        | レシート情報                                                                                                                                                                                                                                                            |

</Table> <tabs> <tab title="Swift" sync="swift"> 

```swift
let subscription = ADJSubscription(
    price: price,
    currency: currency,
    transactionId: transactionId,
    andReceipt: receipt)
```

</Tab> <tab title="Objective-C" sync="objc"> 

```objc
ADJSubscription *subscription = [[ADJSubscription alloc] initWithPrice:price
                                                              currency:currency
                                                         transactionId:transactionId
                                                            andReceipt:receipt];
```

</Tab> </Tabs> 

### [購入データを記録する](record-the-purchase-date)

```objc
- (void)setTransactionDate:(nonnull NSDate *)transactionDate;
```

ユーザーがサブスクリプションを購入した日を記録することができます。SDKはこのデータを返して、レポートします。タイムスタンプを使用して`setTransactionDate`メソッドを呼び出し、この情報を記録します。
<tabs> <tab title="Swift" sync="swift"> 

```swift
let subscription = ADJSubscription(
    price: price,
    currency: currency,
    transactionId: transactionId,
    andReceipt: receipt)
// ...
subscription.setTransactionDate(transactionDate)
```

</Tab> <tab title="Objective-C" sync="objc"> 

```objc
ADJSubscription *subscription = [[ADJSubscription alloc] initWithPrice:price
                                                              currency:currency
                                                         transactionId:transactionId
                                                            andReceipt:receipt];
/// ...
[subscription setTransactionDate:transactionDate];
```

</Tab> </Tabs> 

### [購入地域を記録する](record-the-purchase-region)

```objc
- (void)setSalesRegion:(nonnull NSString *)salesRegion;
```

ユーザーがサブスクリプションを購入した地域を記録することができます。これを行うには、subscriptionオブジェクトの`setSalesRegion`メソッドを呼び、国コードを`NSString`としてパスします。これは、[`priceLocale`](https://developer.apple.com/documentation/storekit/skproduct/1506145-pricelocale?language=swift)オブジェクトの[`countryCode`](https://developer.apple.com/documentation/foundation/nslocale/1643060-countrycode?language=swift)としてフォーマットされる必要があります。
<tabs> <tab title="Swift" sync="swift"> 

```swift
let subscription = ADJSubscription(
    price: price,
    currency: currency,
    transactionId: transactionId,
    andReceipt: receipt)
// ...
subscription.setSalesRegion(salesRegion)
```

</Tab> <tab title="Objective-C" sync="objc"> 

```objc
ADJSubscription *subscription = [[ADJSubscription alloc] initWithPrice:price
                                                              currency:currency
                                                         transactionId:transactionId
                                                            andReceipt:receipt];
/// ...
[subscription setSalesRegion:salesRegion];
```

</Tab> </Tabs> 

### [コールバックパラメーターを追加する](add-callback-parameters)

```objc
- (void)addCallbackParameter:(nonnull NSString *)key value:(nonnull NSString *)value;
```

コールバックパラメーターをサブスクリプションオブジェクトに追加することができます。Adjustは、これらのパラメーターをコールバックURLに追加します。コールバックパラメーターを追加するには、サブスクリプションオブジェクトの`addCallbackParameter`メソッドを呼び出してください。このメソッドを複数回呼び出すことで、複数のコールバックパラメーターを追加できます。
<tabs> <tab title="Swift" sync="swift"> 

```swift
let subscription = ADJSubscription(
    price: price,
    currency: currency,
    transactionId: transactionId,
    andReceipt: receipt)
// ...
subscription.addCallbackParameter("key1", value: "value1")
subscription.addCallbackParameter("key2", value: "value2")
```

</Tab> <tab title="Objective-C" sync="objc"> 

```objc
ADJSubscription *subscription = [[ADJSubscription alloc] initWithPrice:price
                                                              currency:currency
                                                         transactionId:transactionId
                                                            andReceipt:receipt];
/// ...
[subscription addCallbackParameter:@"key1" value:@"value1"];
[subscription addCallbackParameter:@"key2" value:@"value2"];
```

</Tab> </Tabs> 

### [パートナーパラメーターの追加](add-partner-parameters)

```objc
- (void)addPartnerParameter:(nonnull NSString *)key value:(nonnull NSString *)value;
```

パートナーパラメーターをサブスクリプションオブジェクトに追加することができます。SDKは、ユーザーがサブスクリプションを購入した時に、Adjustサーバーへこれらを送信します。Adjustサーバーは、その情報をネットワークパートナーに転送します。パラメーターパラメーターを追加するには、サブスクリプションオブジェクトの`addPartnerParameter`メソッドを呼び出してください。このメソッドを複数回呼び出すことで、複数のコールバックパラメーターを追加できます。
<tabs> <tab title="Swift" sync="swift"> 

```swift
let subscription = ADJSubscription(
    price: price,
    currency: currency,
    transactionId: transactionId,
    andReceipt: receipt)
// ...
subscription.addParameterParameter("key1", value: "value1")
subscription.addParameterParameter("key2", value: "value2")
```

</Tab> <tab title="Objective-C" sync="objc"> 

```objc
ADJSubscription *subscription = [[ADJSubscription alloc] initWithPrice:price
                                                              currency:currency
                                                         transactionId:transactionId
                                                            andReceipt:receipt];
/// ...
[subscription addParameterParameter:@"key1" value:@"value1"];
[subscription addParameterParameter:@"key2" value:@"value2"];
```

</Tab> </Tabs> 

[2\. サブスクリプション情報を送信する](2-send-subscription-information)
--------------------------------------------------------

```objc
+ (void)trackSubscription:(nonnull ADJSubscription *)subscription;
```

サブスクリプションオブジェクトを設定したら、Adjust SDKを使用してそれをAdjustに送信できます。完了したオブジェクトを `trackSubscription`メソッドにパスして、ユーザーのサブスクリプション購入を記録します。
<tabs> <tab title="Swift" sync="swift"> 

```swift
let subscription = ADJSubscription(
   price: price,
   currency: currency,
   transactionId: transactionId,
   andReceipt: receipt)

subscription.setTransactionDate(transactionDate)
subscription.setSalesRegion(salesRegion)

// Add callback parameters

subscription.addCallbackParameter("key1", value: "value1")
subscription.addCallbackParameter("key2", value: "value2")

// Add partner parameters

subscription.addPartnerParameter("key1", value: "value1")
subscription.addCallbackParameter("key2", value: "value2")

Adjust.trackSubscription(subscription)
```

</Tab> <tab title="Objective-C" sync="objc"> 

```objc
ADJSubscription *subscription = [[ADJSubscription alloc] initWithPrice:price
                                                            currency:currency
                                                         transactionId:transactionId
                                                            andReceipt:receipt];
[subscription setTransactionDate:transactionDate];
[subscription setSalesRegion:salesRegion];

/// Add callback parameters
[subscription addCallbackParameter:@"key1" value:@"value1"];
[subscription addCallbackParameter:@"key2" value:@"value2"];

/// Add partner parameters
[subscription addPartnerParameter:@"key1" value:@"value1"];
[subscription addPartnerParameter:@"key2" value:@"value2"];

[Adjust trackSubscription:subscription];
```

</Tab> </Tabs>

