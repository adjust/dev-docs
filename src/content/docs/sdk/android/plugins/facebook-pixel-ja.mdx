---
title: "Facebookピクセル"
description: "Facebookピクセルプラグインを使用して、AdjustにFacebookピクセル情報をパスします。"
slug: "ja/sdk/android/plugins/facebook-pixel"
---

A [Facebook pixel](https://www.facebook.com/business/help/952192354843755?id=1205376682832142) is a web\-only analytics tool from Facebook. As of v4\.34 of the Facebook SDK, you can record pixel events in an app's webview. You can also convert Facebook Pixel events into Facebook App events. To do this, use Hybrid Mobile App Events.

また、Facebook SDKを実装しなくても、Adjust SDKでFacebookピクセルを利用できるようになりました。

## [サンプルアプリ](example-app)

-  [Androidサンプルアプリ](https://github.com/adjust/android_sdk/tree/master/Adjust/example-app-fbpixel)

## [Facebookとの連携](facebook-integration)

### [FacebookアプリID](facebook-app-id)

Facebookピクセルの使用を開始するには、次の手順を実行します。

[FacebookのAndroid SDKガイド](https://developers.facebook.com/docs/android/)の説明の通り、次の手順を実行してFacebookアプリIDをアプリに追加する必要があります。

1. `facebook_app_id`という名前で新しい文字列を追加します。値としてFacebookアプリIDを追加します。

2. `strings.xml`ファイルを開きます。 パスの例：`/app/src/main/res/values/strings.xml`

3. `AndroidManifest.xml`を開きます。

4. uses\-permissionエレメントをマニフェストに追加します：

   <CodeBlock title="AndroidManifest.xml">

   ```xml
   <uses-permission android:name="android.permission.INTERNET"/>
   ```

   </CodeBlock>

5. meta\-dataエレメントをapplicationエレメント内に追加します：

   <CodeBlock title="AndroidManifest.xml">

   ```xml
   <application android:label="@string/app_name" ...>
   ...
   <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/facebook_app_id"/>
   ...
   </application>
   ```

   </CodeBlock>

### [Facebookピクセルの設定](facebook-pixel-configuration)

Facebook Pixelの統合方法については、Facebookのガイドに従ってください。Javascriptコードは以下のように記述する必要があります。

```html
<!-- Facebook Pixel Code -->
<script>
   !function(f,b,e,v,n,t,s)
     ...
   fbq('init', {YOUR_PIXEL_ID});
   fbq('track', 'PageView');
</script>
...
<!-- End Facebook Pixel Code -->
```

次に、Facebookピクセルコードを更新します。手順は[Hybrid Mobile App Eventsガイド](https://developers.facebook.com/docs/app-events/hybrid-app-events)の **Update Your Pixel** に記載されています。

```html
<script>
   !function(f,b,e,v,n,t,s)
     ...
   fbq('init', {YOUR_PIXEL_ID});
   fbq('set', 'mobileBridge', {YOUR_PIXEL_ID}, {YOUR_FB_APP_ID});
</script>
```

<Callout type="important">

You need to call `init` and then `set` immediately afterward. The snippet provided by Facebook contains a `track` method. You can use this method to record a page view event right after you call the `init` method. To record the view event, you need to call `set` between `init` and `track`.

</Callout>

## [Adjust SDKの実装](adjust-sdk-integration)

### [web viewの拡張](augment-the-web-view)

Android web viewアプリの連携ガイドに従ってください。Web View bridgeをロードする際に、 `augmentHybridWebView`メソッドへの呼び出しを追加します。

```java
AdjustBridge.registerAndGetInstance(getApplication(), webview);
```

このステップに到達したら、返されたインスタンスを`adjustBridgeInstance`のような名前で保存します。これを使用して、Facebookインターフェイスを以下のように登録できます。

```java
adjustBridgeInstance.registerFacebookSDKJSInterface();
```

### [イベント名の登録](event-name-registration)

Adjust web bridge SDKは、Facebook PixelイベントをAdjustイベントに変換します。

To use this feature, you need to map Facebook pixels to specific Adjust events. You can also configure a default Adjust event token. To use a default token, you need to add the token before starting the Adjust SDK and recording any pixel event. This includes the copy\-pasted `fbq('track', 'PageView');` event from the Facebook pixel configuration.

イベントをマッピングするには、configインスタンスで`addFbPixelMapping`メソッドを呼び出します。 Facebookイベント名とAdjustイベントトークンをパラメーターとして使用してください。Adjust SDKを初期化する前にこれを呼び出す必要があります。

```js
adjustConfig.addFbPixelMapping("fb_mobile_search", adjustEventTokenForSearch);
adjustConfig.addFbPixelMapping(
   "fb_mobile_purchase",
   adjustEventTokenForPurchase,
);
```

<Callout type="note">

The above example would match when recording `fbq('track', 'Search')` and `fbq('track', 'Purchase')`. Adjust doesn't have access to the full map between Facebook SDK and Javascript events.

</Callout>
<Table>

| ピクセルイベント名            | Facebookアプリのイベント名      |
| ----------------------------- | ------------------------------- |
| ViewContent                   | fb_mobile_content_view          |
| 検索ネットワーク キャンペーン | fb_mobile_search                |
| AddtoCart                     | fb_mobile_add_to_cart           |
| AddToWishlist                 | fb_mobile_add_to_wishlistt      |
| InitiateCheckout              | fb_mobile_initiated_checkout    |
| AddPaymentInfo                | fb_mobile_add_payment_info      |
| 購入                          | fb_mobile_purchase              |
| CompleteRegistration          | fb_mobile_complete_registration |

</Table>

Adjust SDKでは、特定のイベントについてデフォルトのイベントトークンが見つからない場合は、警告をログに記録します。

```text
There is not a default event token configured or a mapping found for event named: 'fb_mobile_search'. It won't be tracked as an adjust event.
```

マッピングを設定していない場合は、デフォルトのAdjustイベントを設定することも可能です。これを行うには、Adjust SDKを初期化する前に`adjustConfig.setFbPixelDefaultEventToken(defaultEventToken);`を呼び出します。
