---
title: "Facebook Pixel"
description: "使用 Facebook pixel 集成，向 Adjust 服务器传送 Facebook pixel 信息。"
slug: "zh/sdk/android/plugins/facebook-pixel"
---

A [Facebook pixel](https://www.facebook.com/business/help/952192354843755?id=1205376682832142) is a web\-only analytics tool from Facebook. As of v4\.34 of the Facebook SDK, you can record pixel events in an app's webview. You can also convert Facebook Pixel events into Facebook App events. To do this, use Hybrid Mobile App Events.

您现在可以在 Adjust SDK 中使用 Facebook Pixel了，无需集成 Facebook SDK。

## [示例应用](example-app)

-  [安卓示例应用](https://github.com/adjust/android_sdk/tree/master/Adjust/example-app-fbpixel)

## [Facebook 集成](facebook-integration)

### [Facebook App ID](facebook-app-id)

要开始使用 Facebook Pixel，请按照下列步骤操作：

如 [Facebook Android SDK 指南](https://developers.facebook.com/docs/android/)中说明的一样，您需要进行下列操作，将 Facebook App ID 添加至应用：

1. 添加名为`facebook_app_id`的新字符串。将 Facebook App ID 添加为值。

2. 打开`strings.xml`文件。路径示例：`/app/src/main/res/values/strings.xml` .

3. 打开`AndroidManifest.xml` 。

4. 向 manifest 添加一个 uses_permission 元素：

   <CodeBlock title="AndroidManifest.xml">

   ```xml
   <uses-permission android:name="android.permission.INTERNET" id="sl-md0000000"/>
   ```

   </CodeBlock>

5. 将一个 meta\-data 元素添加至 application 元素：

   <CodeBlock title="AndroidManifest.xml">

   ```xml
   <application android:label="@string/app_name" ... id="sl-md0000000">
   ...
   <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/facebook_app_id" id="sl-md0000000"/>
   ...
   </application>
   ```

   </CodeBlock>

### [Facebook Pixel配置](facebook-pixel-configuration)

请参阅 Facebook 的 Pixel 集成指南，按照其中说明操作。Javascript 代码应当以如下形式呈现：

```html
<!-- Facebook Pixel Code -->
<script id="sl-md0000000">
   !function(f,b,e,v,n,t,s)
     ...
   fbq('init', {YOUR_PIXEL_ID});
   fbq('track', 'PageView');
</script>
...
<!-- End Facebook Pixel Code -->
```

下一步，更新您的 Facebook Pixel代码。请前往 [Update Your Pixel](https://developers.facebook.com/docs/app-events/hybrid-app-events) 一节，找到 **Hybrid Mobile App Events 指南** ，按照其中说明操作。

```html
<script id="sl-md0000000">
   !function(f,b,e,v,n,t,s)
     ...
   fbq('init', {YOUR_PIXEL_ID});
   fbq('set', 'mobileBridge', {YOUR_PIXEL_ID}, {YOUR_FB_APP_ID});
</script>
```

<Callout type="important">

You need to call `init` and then `set` immediately afterward. The snippet provided by Facebook contains a `track` method. You can use this method to record a page view event right after you call the `init` method. To record the view event, you need to call `set` between `init` and `track`.

</Callout>

## [Adjust SDK 集成](adjust-sdk-integration)

### [增强 \(Augment\) web view](augment-the-web-view)

请查看 Android web view 应用集成指南，按照其中说明操作。在加载 Web View bridge时，添加对 `augmentHybridWebView` 方法的调用。

```java
AdjustBridge.registerAndGetInstance(getApplication(), webview);
```

到达该步骤时，请将返回的实例保存为`adjustBridgeInstance`的形式。然后借助保存的实例像这样注册 Facebook 界面：

```java
adjustBridgeInstance.registerFacebookSDKJSInterface();
```

### [事件名称注册](event-name-registration)

Adjust web bridge SDK 会将 Facebook Pixel事件转化为 Adjust 事件。

To use this feature, you need to map Facebook pixels to specific Adjust events. You can also configure a default Adjust event token. To use a default token, you need to add the token before starting the Adjust SDK and recording any pixel event. This includes the copy\-pasted `fbq('track', 'PageView');` event from the Facebook pixel configuration.

要映射事件，请在 config 实例上调用`addFbPixelMapping`方法。将 Facebook 事件名称和 Adjust 事件识别码用作参数。您需要在初始化 Adjust SDK 前进行该调用。

```js
adjustConfig.addFbPixelMapping("fb_mobile_search", adjustEventTokenForSearch);
adjustConfig.addFbPixelMapping(
   "fb_mobile_purchase",
   adjustEventTokenForPurchase,
);
```

<Callout type="note">

The above example would match when recording `fbq('track', 'Search')` and `fbq('track', 'Purchase')`. Adjust doesn't have access to the full map between Facebook SDK and Javascript events.

</Callout>
<Table>

| Pixel 事件名称           | Facebook 应用事件名称           |
| ------------------------ | ------------------------------- |
| View Content（查看内容） | fb_mobile_content_view          |
| 搜索                     | fb_mobile_search                |
| AddToCart                | fb_mobile_add_to_cart           |
| Add To Wishlist          | fb_mobile_add_to_wishlistt      |
| InitiateCheckout         | fb_mobile_initiated_checkout    |
| AddPaymentInfo           | fb_mobile_add_payment_info      |
| Purchase                 | fb_mobile_purchase              |
| CompleteRegistration     | fb_mobile_complete_registration |

</Table>

如果 Adjust SDK 无法找到特定事件的默认事件识别码，就会记录下警告信息。

```text
There is not a default event token configured or a mapping found for event named: 'fb_mobile_search'. It won't be tracked as an adjust event.
```

如果您没有设置映射，则可以设置默认 Adjust 事件。为此，请在初始化 Adjust SDK 之前调用`adjustConfig.setFbPixelDefaultEventToken(defaultEventToken);` 。
