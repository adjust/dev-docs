---
title: "Facebook Pixel"
description: "使用 Facebook pixel 集成，向 Adjust 服务器传送 Facebook pixel 信息。"
slug: "en/sdk/android/plugins/facebook-pixel"
---
[Facebook 像素](https://www.facebook.com/business/help/952192354843755?id=1205376682832142)是 Facebook 的网页专用数据分析工具。自 Facebook SDK v4\.34 起，您可以在应用的 webview 中跟踪像素事件。您也可以将 Facebook 像素事件转化为 Facebook 应用事件。为此，请使用 Hybrid Mobile App Events。

您现在可以在 Adjust SDK 中使用 Facebook 像素了，无需集成 Facebook SDK。

[示例应用](example-app)
-------------------

* [安卓示例应用](https://github.com/adjust/android_sdk/tree/master/Adjust/example-app-fbpixel)

[Facebook 集成](facebook-integration)
-----------------------------------

### [Facebook App ID \(Facebook 应用 ID\)](facebook-app-id)

要开始使用 Facebook 像素，请按照下列步骤操作：

如 [Facebook Android SDK 指南](https://developers.facebook.com/docs/android/)中说明的一样，您需要进行下列操作，将 Facebook App ID 添加至应用：

1. 添加名为`facebook_app_id`的新字符串。将 Facebook App ID 添加为值。

2. 打开`strings.xml`文件。路径示例：`/app/src/main/res/values/strings.xml` .

3. 打开`AndroidManifest.xml` 。

4. 向 manifest 添加一个 uses\_permission 元素：

   ```xml
   <uses-permission android:name="android.permission.INTERNET" id="sl-md0000000"/>
   ```

5. 将一个 meta\-data 元素添加至 application 元素：

   ```xml
   <application android:label="@string/app_name" ... id="sl-md0000000">
   ...
   <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/facebook_app_id" id="sl-md0000000"/>
   ...
   </application>
   ```

### [Facebook 像素配置](facebook-pixel-configuration)

请参阅 Facebook 的像素集成指南，按照其中说明操作。Javascript 代码应当以如下形式呈现：

```html
<!-- Facebook Pixel Code -->
<script id="sl-md0000000">
   !function(f,b,e,v,n,t,s)
     ...
   fbq('init', {YOUR_PIXEL_ID});
   fbq('track', 'PageView');
</script>
...
<!-- End Facebook Pixel Code -->
```

下一步，更新您的 Facebook 像素代码。请前往 [Update Your Pixel](https://developers.facebook.com/docs/app-events/hybrid-app-events) 一节，找到 **Hybrid Mobile App Events 指南** ，按照其中说明操作。

```html
<script id="sl-md0000000">
   !function(f,b,e,v,n,t,s)
     ...
   fbq('init', {YOUR_PIXEL_ID});
   fbq('set', 'mobileBridge', {YOUR_PIXEL_ID}, {YOUR_FB_APP_ID});
</script>
```

<callout type="important"> 

您需要调用 `init`，随后立即调用 `set`。Facebook 提供的片段包含一个 `track` 方法。您可以使用该方法在调用`init`方法后立刻跟踪页面查看事件。如需跟踪查看事件，您需要在`init`和`track`之间调用`set`。
</Callout> 

[Adjust SDK 集成](adjust-sdk-integration)
---------------------------------------

### [增强 \(Augment\) web view](augment-the-web-view)

请查看 Android web view 应用集成指南，按照其中说明操作。在加载 Web View bridge时，添加对 `augmentHybridWebView` 方法的调用。

```java
AdjustBridge.registerAndGetInstance(getApplication(), webview);
```

到达该步骤时，请将返回的实例保存为`adjustBridgeInstance`的形式。然后借助保存的实例像这样注册 Facebook 界面：

```java
adjustBridgeInstance.registerFacebookSDKJSInterface();
```

### [事件名称注册](event-name-registration)

Adjust web bridge SDK 会将 Facebook 像素事件转化为 Adjust 事件。

要使用该功能，请将 Facebook 像素映射到具体的 Adjust 事件。您也可以配置一个默认 Adjust 事件识别码。要使用默认识别码，您需要在启动 Adjust SDK 及跟踪任何像素事件之前添加识别码。这包括从 Facebook 像素配置中复制粘贴的 `fbq('track', 'PageView');` 事件。

要映射事件，请在 config 实例上调用`addFbPixelMapping`方法。将 Facebook 事件名称和 Adjust 事件识别码用作参数。您需要在初始化 Adjust SDK 前进行该调用。

```js
adjustConfig.addFbPixelMapping("fb_mobile_search", adjustEventTokenForSearch);
adjustConfig.addFbPixelMapping(
   "fb_mobile_purchase",
   adjustEventTokenForPurchase,
);
```

<callout type="note"> 

在跟踪`fbq('track', 'Search')`和`fbq('track', 'Purchase')`时，上述示例将发生匹配。Adjust 无法访问 Facebook SDK 与 Javascript 事件之间的完整映射。
</Callout> <table> 

|        像素事件名称        |            Facebook 应用事件名称            |
|----------------------|---------------------------------------|
| View Content（查看内容）   | fb\_mobile\_content\_view          |
| 搜索                   | fb\_mobile\_search                  |
| AddToCart            | fb\_mobile\_add\_to\_cart         |
| Add To Wishlist      | fb\_mobile\_add\_to\_wishlistt    |
| InitiateCheckout     | fb\_mobile\_initiated\_checkout    |
| AddPaymentInfo       | fb\_mobile\_add\_payment\_info    |
| Purchase             | fb\_mobile\_purchase                |
| CompleteRegistration | fb\_mobile\_complete\_registration |

</Table> 

如果 Adjust SDK 无法找到特定事件的默认事件识别码，就会记录下警告信息。

```text
There is not a default event token configured or a mapping found for event named: 'fb_mobile_search'. It won't be tracked as an adjust event.
```

如果您没有设置映射，则可以设置默认 Adjust 事件。为此，请在初始化 Adjust SDK 之前调用`adjustConfig.setFbPixelDefaultEventToken(defaultEventToken);` 。

