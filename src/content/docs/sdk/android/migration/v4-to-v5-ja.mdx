---
title: "SDK v5移行ガイド"
description: "SDK v4からSDK v5にアップグレードするには、このガイドに従ってください。"
slug: "ja/sdk/android/migration/v4-to-v5"
sidebar-position: 1
---

<Callout type="important" title="オープンベータ版">

SDK v5はオープンベータ版です。全ての機能は変更される可能性があります。

</Callout>

## [Before you begin](before-you-begin)

SDK v5にアップデートする前に行う必要のあることは以下の通りです：

1. SDK v5は[SDKシグネチャーの検証](https://help.adjust.com/ja/article/sdk-signature)をネイティブにサポートします。現在SDKシグネチャーライブラリを使用している場合は、まずこれをアンインストールする必要があります。
2. アプリがバージョン[**21**](https://developer.android.com/tools/releases/platforms#5.0)以前のAPIバージョンを対象にしている場合、SDK v5を使用する前にアプリをアップデートする必要があります。

## [ベータ版のSDKをインストールする](install-the-sdk)

SDK v5の使用を開始するには、プロジェクトにdependencyとしてSDK v5を追加する必要があります。これを行うには、以下の手順に従ってください。

1. ベータリポジトリを`build.gradle`ファイルに追加します。

   <CodeBlock title="build.gradle">

   ```groovy
   repositories {
      maven {
         url "https://oss.sonatype.org/content/repositories/snapshot/"
      }
   }
   ```

   </CodeBlock>

2. 現在`build.gradle`ファイルにある古いバージョンの SDK を全て削除します。

3. `build.gradle`ファイルに以下のdependencyを追加します：

   <CodeBlock title="build.gradle">

   ```groovy
   dependencies {
      implementation 'com.adjust.sdk:adjust-android:5.0.0-SNAPSHOT'
      implementation 'com.android.installreferrer:installreferrer:2.2'
      // Add the following if you are using the Adjust SDK inside web views on your app
      implementation 'com.adjust.sdk:adjust-android-webbridge:5.0.0-SNAPSHOT'
   }
   ```

   </CodeBlock>

## [Changes](changes)

<Callout type="warning">

SDK v5はメジャーバージョンアップです。つまり、コードを更新しなければならないような大きな変更があるということです。

</Callout>

v5 SDKをインストールしたら、新しいAPIを使用するために既存のAdjustコードを更新する必要があります。

### [初期化メソッド](init-method)

<MinorVersion changed="v5">

SDK v4では、初期化メソッドは`Adjust.onCreate(AdjustConfig)`です。SDK v5では`Adjust.initSdk(AdjustConfig)`に変更されています。

</MinorVersion>
<CodeBlock useDiffSyntax>

```java
- Adjust.onCreate(adjustConfig); // v4
+ Adjust.initSdk(adjustConfig); // v5
```

</CodeBlock>

### [Configuration](configuration)

このセクションでは、SDK設定の変更について説明します。

#### [SDKを無効化・有効化する](disable-enable-sdk)

<MinorVersion changed="v5">

SDK v4では、`boolean`値で`Adjust.setEnabled()`を呼び出すことで、SDKを有効化・無効化することができます。

</MinorVersion>

-  SDKを無効化するには、`Adjust.setEnabled(false)`を呼び出します。
-  SDKを有効化するには、`Adjust.setEnabled(true)`を呼び出します。

```java
Adjust.setEnabled(false); // disable SDK
Adjust.setEnabled(true); // enable SDK
```

SDK v5では、わかりやすくするためにこの機能は別々のコマンドに分割されています。

-  SDKを無効化するには、`Adjust.disable()`を呼び出します。
-  SDKを有効化するには、`Adjust.enable()`を呼び出します。

```java
Adjust.disable(); // disable SDK
Adjust.enable(); // enable SDK
```

#### [Offline mode](offline-mode)

<MinorVersion changed="v5">

SDK v4では、`boolean`値で`Adjust.setOfflineMode()`を呼び出すことで、SDKでオフラインモードを有効化・無効化することができます。

</MinorVersion>

```java
Adjust.setOfflineMode(false); // put SDK in offline mode
Adjust.setOfflineMode(true); // put SDK back in online mode
```

SDK v5では、わかりやすくするためにこの機能は別々のコマンドに分割されています。

-  SDKをオフラインモードに設定するには、`Adjust.switchToOfflineMode()`を呼び出します。
-  SDKをオンラインモードに戻すには、`Adjust.switchBackToOnlineMode()`を呼び出します。

```java
Adjust.switchToOfflineMode(); // put SDK in offline mode
Adjust.switchBackToOnlineMode(); // put SDK back in online mode
```

#### [Event buffering](event-buffering)

<MinorVersion removed="v5">

SDK v4はイベントバッファリングをサポートしています。この機能は、リクエストイベント、広告収益、Pushトークン、その他の情報をローカルバッファに保存し、後日送信します。

</MinorVersion>

```java
adjustConfig.setEventBufferingEnabled(true);
```

この設定はSDK v5では廃止されています。

#### [カスタムユーザーエージェント文字列](custom-user-agent)

<MinorVersion removed="v5">

SDK v4は、ユーザーエージェント文字列で`AdjustConfig.setUserAgent()`を呼び出すことによるカスタムユーザーエージェントの設定をサポートしています。

</MinorVersion>

```java
adjustConfig.setUserAgent("user_agent_value");
```

この設定はSDK v5では廃止されています。

#### [Set whether a device is known](set-device-known)

<MinorVersion removed="v5">

SDK v4では、`AdjustConfig.setDeviceKnown()`メソッドを呼び出して、デバイスが既知かどうかをSDKに手動で通知することができます。

</MinorVersion>

```java
adjustConfig.setDeviceKnown(true);
```

この設定はSDK v5では廃止されています。

#### [SDKの起動を遅らせる](delay-sdk-start)

<MinorVersion removed="v5">

SDK v4では、`AdjustConfig.setDelayStart()`を最大 **120秒** 遅延させて呼び出すことで、SDKの開始を遅延させることができます。

</MinorVersion>

```java
adjustConfig.setDelayStart(delay);
```

この設定はSDK v5では廃止されています。

### [記録機能](recording-features)

このセクションでは、Adjustに情報を送信する機能の変更点について説明します。

#### [セッション情報を送信する](send-session-info)

<MinorVersion changed="v5">

SDK v4では、`ActivityLifecycleCallbacks`を実装し、アクティビティ再開時と一時停止時にそれぞれ`Adjust.onResume()`と`Adjust.onPause()`を呼び出すことで、アクティビティライフサイクルのコールバックを登録する必要があります。

</MinorVersion>

SDK v5では、`ActivityLifecycleCallbacks`機能はSDKによって処理されます。コードから全てのカスタム アクティビティ ライフサイクル コールバックを削除してください。

#### [Session callback parameters](callback-params)

<MinorVersion changed="v5">

SDK v5では、セッション コールバック パラメーターはグローバル コールバック パラメーターに名称変更されました。

</MinorVersion>
<Tabs>
<Tab title="v4" sync="v4">

```java
Adjust.addSessionCallbackParameter("foo", "bar");
Adjust.removeSessionCallbackParameter("foo");
Adjust.resetSessionCallbackParameters();
```

</Tab>
<Tab title="v5" sync="v5">

```java
Adjust.addGlobalCallbackParameter("foo", "bar");
Adjust.removeGlobalCallbackParameter("foo");
Adjust.removeGlobalCallbackParameters();
```

</Tab>
</Tabs>

#### [Session partner parameters](partner-params)

<MinorVersion changed="v5">

SDK v5では、セッション パートナー パラメーターはグローバル パートナー パラメーターに名称変更されました。

</MinorVersion>
<Tabs>
<Tab title="v4" sync="v4">

```java
Adjust.addSessionPartnerParameter("foo", "bar");
Adjust.removeSessionPartnerParameter("foo");
Adjust.resetSessionPartnerParameters();
```

</Tab>
<Tab title="v5" sync="v5">

```java
Adjust.addGlobalPartnerParameter("foo", "bar");
Adjust.removeGlobalPartnerParameter("foo");
Adjust.removeGlobalPartnerParameters();
```

</Tab>
</Tabs>

#### [Event deduplication](event-deduplication)

<MinorVersion changed="v5">

SDK v4では、イベント重複排除はイベント`order ID`と組み合わされ、最大10個のユニークIDに制限されています。

</MinorVersion>

```java
AdjustEvent event = new AdjustEvent("event_token");
event.setOrderId("deduplication_id");
Adjust.trackEvent(event);
```

SDK v5では、この機能は`order ID`から切り離され、イベント重複排除のために`deduplicationId`という新しいIDフィールドが追加されました。ユーザーは、重複イベントを識別するためにリストに追加可能な`deduplicationId`の数にカスタム制限を設定できます。デフォルトでは、制限は **10** に設定されています。

```java
AdjustConfig adjustConfig = new AdjustConfig(this, appToken, environment);

adjustConfig.setEventDeduplicationIdsMaxSize(20); // if not set, then 10
Adjust.initSdk(adjustConfig);

AdjustEvent event = new AdjustEvent("event_token");
event.setDeduplicationId("deduplication_id");
Adjust.trackEvent(event);
```

#### [AdjustAttribution class](attribution-class)

<MinorVersion changed="v5">

SDK v4では、`AdjustAttribution`コールは`adid`というプロパティを持っています。SDK v5 では、`AdjustAttribution` クラスから`adid`プロパティが削除されました。[`getAdid()`ゲッターメソッド](#device-id-getters)を使用してデバイスのADIDを取得できます。

</MinorVersion>

### [Deep linking](deep-links)

このセクションでは、SDK v5でのディープリンクに関する変更点を説明します。

#### [Reattribution using deep links](reattribution-using-deep-links)

<MinorVersion changed="v5">

Adjust SDKにディープリンクデータをパスするためのメソッドの名前が変更されました。

</MinorVersion>

-  v4：`Adjust.appWillOpenUrl()`
-  v5：`Adjust.processDeeplink()`

どちらのメソッドも同じ引数を受け取ります。

<CodeBlock useDiffSyntax>

```java
- Adjust.appWillOpenUrl(data, getApplicationContext()); //v4
+ Adjust.processDeeplink(data, getApplicationContext()); //v5
```

</CodeBlock>

#### [Deferred deep linking callback](deferred-callback)

<MinorVersion changed="v5">

SDK v4では、`setOnDeeplinkResponseListener`メソッドを呼び出してディファード ディープリンク コールバックを処理できます。

</MinorVersion>

```java
adjustConfig.setOnDeeplinkResponseListener(new OnDeeplinkResponseListener() {
            @Override
            public boolean launchReceivedDeeplink(Uri deeplink) {
                Log.d("example", "Deferred deep link callback called!");
                return true;
            }
        });
```

SDK v5では、わかりやすくするためにこのメソッドは`setOnDeferredDeeplinkResponseListener`に改名されています。全ての引数は同じです。

```java
adjustConfig.setOnDeferredDeeplinkResponseListener(new OnDeferredDeeplinkResponseListener() {
            @Override
            public boolean launchReceivedDeeplink(Uri deeplink) {
                Log.d("example", "Deferred deep link callback called!");
                return true;
            }
        });
```

### [Privacy features](privacy-features)

このセクションでは、Adjust SDKのプライバシー機能の変更点について説明します。

#### [COPPA compliance](coppa-compliance)

<MinorVersion changed="v5">

SDK v4では、[COPPA準拠](/ja/sdk/android/features/privacy#coppa-compliance)は`AdjustConfig`クラスを使用して設定され、SDKの初期化中に読み込まれます。つまり、SDKを初期化したら値を更新することはできません。

</MinorVersion>

```java
adjustConfig.setCoppaCompliantEnabled(true);
```

SDK v5では、このメソッドは`Adjust`クラスで利用可能です。つまり、`Adjust.enableCoppaCompliance()`を呼び出してCOPPA準拠を有効化するか、`disableCoppaCompliance()`を呼び出してCOPPA準拠を無効化することで、いつでも設定を変更することができます。

```java
Adjust.enableCoppaCompliance(getApplicactionContext());
Adjust.disableCoppaCompliance(getApplicationContext());
```

#### [Play Store Kids Apps](play-store-kids)

<MinorVersion changed="v5">

SDK v4では、`AdjustConfig`クラスを使用してアプリを[Playストアの子供向けアプリ](/ja/sdk/android/features/privacy#play-store-kids-apps)として表示できます。このプロパティはSDKの初期化中に読み込まれるため、SDKを初期化したら値を更新することはできません。

</MinorVersion>

```java
adjustConfig.setPlayStoreKidsAppEnabled(true);
```

SDK v5では、このメソッドは`Adjust`クラスで利用可能です。つまり、`Adjust.enablePlayStoreKidsApp()`を呼び出してアプリをPlayストアの子供向けアプリとして表示するか、`disablePlayStoreKidsApp()`を呼び出してアプリをPlayストアの子供向けアプリとして表示するのを解除することで、いつでも設定を変更できます。

```java
Adjust.enablePlayStoreKidsApp(getApplicationContext());
Adjust.disablePlayStoreKidsApp(getApplicationContext());
```

#### [特定のソースの広告収益を送信する](send-ad-revenue)

<MinorVersion changed="v5">

SDK v4では、広告収益ソースは`AdjustConfig`クラスの定数として定義されています。SDK v5では、広告収益ソースは文字列としてパスされる必要があります。

</MinorVersion>
<CodeBlock useDiffSyntax>

```java
- AdjustAdRevenue adjustAdRevenue = new AdjustAdRevenue(AdjustConfig.AD_REVENUE_APPLOVIN_MAX); // v4
+ AdjustAdRevenue adjustAdRevenue = new AdjustAdRevenue("applovin_max_sdk"); // v5
```

</CodeBlock>
<Table>

| v4                                          | v5                        |
| ------------------------------------------- | ------------------------- |
| `AdjustConfig.AD_REVENUE_APPLOVIN_MAX`      | `"applovin_max_sdk"`      |
| `AdjustConfig.AD_REVENUE_ADMOB`             | `"admob_sdk"`             |
| `AdjustConfig.AD_REVENUE_IRONSOURCE`        | `"ironsource_sdk"`        |
| `AdjustConfig.AD_REVENUE_ADMOST`            | `"admost_sdk"`            |
| `AdjustConfig.AD_REVENUE_UNITY`             | `"unity_sdk"`             |
| `AdjustConfig.AD_REVENUE_HELIUM_CHARTBOOST` | `"helium_chartboost_sdk"` |
| `AdjustConfig.AD_REVENUE_ADX`               | `"adx_sdk"`               |
| `AdjustConfig.AD_REVENUE_SOURCE_PUBLISHER`  | `"publisher_sdk"`         |
| `AdjustConfig.AD_REVENUE_TRADPLUS`          | `"tradplus_sdk"`          |
| `AdjustConfig.AD_REVENUE_TOPON`             | `"topon_sdk"`             |
| `AdjustConfig.AD_REVENUE_MOPUB`             | `"mopub"`                 |

</Table>

#### [データレジデンシーとURL戦略を設定する](url-strategy)

<MinorVersion changed="v5">

SDK v4では、URL戦略とデータレジデンシードメインは`AdjustConfig`クラスの定数として定義されています。

</MinorVersion>

```java
adjustConfig.setUrlStrategy(AdjustConfig.DATA_RESIDENCY_EU);
```

SDK v5では、選択したドメインを配列としてパスする必要があります。また、以下を設定することもできます：

-  `useSubdomains` （`boolean`）：ソースにサブドメインのプレフィックスを付けるかどうか。
-  `isDataResidency` （`boolean`）：ドメインをデータレジデンシーに使用するかどうか。

```java
List<string id="sl-md0000000"> domains = Arrays.asList("domain"); // eg. eu.adjust.com
boolean useSubdomains = true; // or false
boolean isDataResidency = false; // or true for data residency
adjustConfig.setUrlStrategy(domains, useSubdomains, isDataResidency);
```

SDK v5でのURL戦略の設定方法については、以下の表をご確認ください。

<Table autoWidth="1,2">

| v4                                  | v5 \- メイン・フォールバックドメイン | v5 \- サブドメインを使用 | v5 \- データレジデンシー |
| ----------------------------------- | ------------------------------------ | ------------------------ | ------------------------ |
| `AdjustConfig.DATA_RESIDENCY_EU`    | `"eu.adjust.com"`                    | `true`                   | `true`                   |
| `AdjustConfig.DATA_RESIDENCY_TR`    | `"tr.adjust.com"`                    | `true`                   | `true`                   |
| `AdjustConfig.DATA_RESIDENCY_US`    | `"us.adjust.com"`                    | `true`                   | `true`                   |
| `AdjustConfig.URL_STRATEGY_CHINA`   | `"adjust.world"`。 `"adjust.com"`    | `true`                   | `false`                  |
| `AdjustConfig.URL_STRATEGY_CN`      | `"adjust.cn"`。 `"adjust.com"`       | `true`                   | `false`                  |
| `AdjustConfig.URL_STRATEGY_CN_ONLY` | `"adjust.cn"`                        | `true`                   | `false`                  |
| `AdjustConfig.URL_STRATEGY_INDIA`   | `"adjust.net.in"`。 `"adjust.com"`   | `true`                   | `false`                  |

</Table>

##### [Examples](examples)

<CodeBlock title="インド URL戦略">

```java
config.setUrlStrategy(Arrays.asList("adjust.net.in", "adjust.com"), true, false);
```

</CodeBlock>
<CodeBlock title="中国 URL戦略">

```java
adjustConfig.setUrlStrategy(Arrays.asList("adjust.world", "adjust.com"), true, false);
```

</CodeBlock>
<CodeBlock title="中国限定 URL戦略">

```java
adjustConfig.setUrlStrategy(Arrays.asList("adjust.cn"), true, false);
```

</CodeBlock>
<CodeBlock title="EU データレジデンシー">

```java
adjustConfig.setUrlStrategy(Arrays.asList("eu.adjust.com"), true, true);
```

</CodeBlock>
<CodeBlock title="トルコ データレジデンシー">

```java
adjustConfig.setUrlStrategy(Arrays.asList("tr.adjust.com"), true, true);
```

</CodeBlock>
<CodeBlock title="米国 データレジデンシー">

```java
adjustConfig.setUrlStrategy(Arrays.asList("us.adjust.com"), true, true);
```

</CodeBlock>

#### [サードパーティとの共有をグローバルに無効化する](disable-sharing-globally)

<MinorVersion removed="v5">

SDK v4では、`Adjust.disableThirdPartySharing()`メソッドを呼び出すことで、サードパーティとの情報共有をグローバルに無効化することができます。

</MinorVersion>

```java
Adjust.disableThirdPartySharing(getApplicationContext());
```

この機能はSDK v5では削除されました。SDK v5では、`Adjust.trackThirdPartySharing()`メソッドを使用してサードパーティとのデータ共有を有効化または無効化できます。

```java
val adjustThirdPartySharing = AdjustThirdPartySharing(true);
Adjust.trackThirdPartySharing(adjustThirdPartySharing);
```

### [Get device information](device-info)

このセクションでは、SDK v5におけるデバイス情報ゲッターの変更点について説明します。

#### [インストールリファラーゲッター](install-referrer-getters)

<MinorVersion added="v5">

SDK v5には、インストールリファラー情報を取得するための新しいゲッターメソッドが含まれています。

</MinorVersion>
<CodeBlock title="Google Play Store Referrer">

```java
Adjust.getGooglePlayInstallReferrer(getApplicationContext(), onGooglePlayInstallReferrerReadListener);
```

</CodeBlock>
<CodeBlock title="Huawei インストールリファラー">

```java
AdjustHuaweiReferrer.getHuaweiAppGalleryInstallReferrer(getApplicationContext(), onHuaweiInstallReferrerReadListener);
```

</CodeBlock>
<CodeBlock title="Samsung インストールリファラー">

```java
AdjustSamsungReferrer.getSamsungInstallReferrer(getApplicationContext(), onSamsungInstallReferrerReadListener);
```

</CodeBlock>
<CodeBlock title="Vivo インストールリファラー">

```java
AdjustVivoReferrer.getVivoInstallReferrer(getApplicationContext(), onSamsungInstallReferrerReadListener);
```

</CodeBlock>
<CodeBlock title="Xiaomi インストールリファラー">

```java
AdjustXiaomiReferrer.getXiaomiInstallReferrer(getApplicationContext(), onSamsungInstallReferrerReadListener);
```

</CodeBlock>

#### [デバイスIDゲッター](device-id-getters)

<MinorVersion changed="v5">

SDK v4では、全てのデバイスIDゲッターメソッドは同期的に実行されます。SDK v5では、これらのメソッドは非同期に実行されるように変更されまています。

</MinorVersion>
<CodeBlock title="ADIDゲッター">

```java
Adjust.getAdId(onAdidReadListener);
```

</CodeBlock>
<CodeBlock title="アトリビューション情報ゲッター">

```java
Adjust.getAttribution(onAttributionReadListener);
```

</CodeBlock>
<CodeBlock title="OAIDゲッター">

```java
AdjustOaid.getOaid(getApplicationContext(), onOaidReadListener);
```

</CodeBlock>
<CodeBlock title="Amazon ADIDゲッター">

```java
Adjust.getAmazonAdId(getApplicationContext(), onAmazonAdIdReadListener);
```

</CodeBlock>
<CodeBlock title="SDKバージョンゲッター">

```java
Adjust.getSdkVersion(onSdkVersionReadListener);
```

</CodeBlock>
<CodeBlock title="有効化ステータスゲッター">

```java
Adjust.isEnabled(getApplicationContext(), onIsEnabledListener);
```

</CodeBlock>

### [Plugins](plugins)

SDK v5は機能を拡張するプラグインをサポートしています。

#### [Huawei インストールリファラープラグイン](huawei-plugin)

<MinorVersion added="v5">

SDK v5は、デバイスのインストールリファラープラグイン情報を記録するHuawei インストールリファラープラグインをサポートしています。プラグインを追加するには、`build.gradle`ファイルに以下のdependencyを追加します：

</MinorVersion>
<CodeBlock title="build.gradle">

```groovy
dependencies {
   implementation 'com.adjust.sdk:adjust-android-huawei-referrer:5.0.0-SNAPSHOT'
}
```

</CodeBlock>

#### [Meta インストールリファラープラグイン](mir-plugin)

<MinorVersion added="v5">

SDK v5は、[Metaのインストールリファラー](https://developers.facebook.com/docs/app-ads/meta-install-referrer)情報を記録するMeta インストールリファラープラグインをサポートしています。この情報を読み取る方法は以下の通りです：

</MinorVersion>

1. `build.gradle`ファイルに以下のdependencyを追加します：

   <CodeBlock title="build.gradle">

   ```groovy
   dependencies {
      implementation 'com.adjust.sdk:adjust-android-meta-referrer:5.0.0-SNAPSHOT'
   }
   ```

   </CodeBlock>

2. Find your Meta app ID in your [App Dashboard](https://developers.facebook.com/apps). See Meta's [App Dashboard documentation](https://developers.facebook.com/docs/development/create-an-app/app-dashboard) for more information.

3. Pass your App ID as a `String` argument to the `AdjustConfig.setFbAppId` method.

   <CodeBlock highlight="{range: 2}">

   ```java
   AdjustConfig config = new AdjustConfig(this, appToken, environment);
   config.setFbAppId(<fb_app_id_string id="sl-md0000000">);
   Adjust.initSdk(config);
   ```

   </CodeBlock>

#### [削除されたプラグイン](removed-plugins)

<MinorVersion removed="v5">

SDK v5では以下のプラグインが削除されました：

</MinorVersion>

-  Criteo
-  Trademob
-  Sociomatic
