---
title: Link Resolution
description: Set up link resolution for email deep links.
slug: en/sdk/ios/features/deep-links/resolution
sidebar-position: 4
versions:
   - label: v5
     value: v5
     default: true
   - label: v4
     value: v4
redirects:
   v4: /en/sdk/ios/v4/features/deep-links/resolution
---

When sending marketing emails that link to iOS apps, there is a challenge due to conflicting requirements:

- **Email marketing platforms** need to replace original links with redirect URLs to record clicks and measure campaign performance.
- **Universal links** should provide a seamless experience to users who have the app installed by opening links in the app directly.

Due to iOS limitations for universal links, email redirect URLs open in the browser instead of the app. This leads to a suboptimal user experience, often requiring multiple steps for the user to open the app.

Adjust's Link Resolution feature resolves this conflict. It follows the redirect chain to reach the final destination URL and then passes that URL to your app for deep link handling. This maintains both email analytics and seamless in-app experiences for your users.

## Before you begin

- [Configure deep link settings](/en/sdk/ios/features/deep-links/configure-deep-link-settings)
- [Set up direct deep linking](/en/sdk/ios/features/deep-links/direct)
- [Test deep linking](/en/sdk/ios/features/deep-links/testing)

## How it works {#how-it-works}

1. You create a campaign in your email marketing platform.
2. In the emails, you use Adjust deep links.
3. When you send the emails, the email marketing platform replaces the Adjust deep links with its email redirect URLs.

   For example, your original URL:  
   `https://brandname.go.link/summer-clothes?promo=beach&adj_t=abc123`

   is replaced with an email redirect URL:  
   `https://email.example.com/2wuTnQvU`

   Note: "example.com" is your domain and "email" is your subdomain dedicated to email click measurement.

4. A user who has your app installed clicks on the email redirect URL in your email, which opens as a universal link in your app.
5. Your app passes the email redirect URL to the link resolution method in the Adjust SDK.
6. The link resolution method compares the domain in the email redirect URL against the link resolution domains configured in the Adjust SDK, and one of two things happens:

   - Domains don't match - The method returns the deep link as is.
   - Domains match - The method resolves the link and returns the resulting deep link.

   The Adjust SDK will follow up to ten redirects when attempting to resolve to the final destination URL. If there are more than ten redirects, the SDK will return the tenth redirect URL.

<Callout type="note">

When a user without your app clicks on the redirect URL, iOS handles this as a normal web URL and redirects the user to the App Store. In this case, Link Resolution isn't applicable.

</Callout>

## Setup {#setup}

### 1. Choose Subdomain

Choose a subdomain (or root domain) dedicated to email click measurement. If you already have a subdomain for this purpose, choose an additional one to set up. A new subdomain is required to avoid issues with migrating live email traffic on an existing subdomain.

**Example:** `email.example.com`

### 2. Set up CDN

Set up a content delivery network (CDN) to manage incoming requests for your email redirect domain:

- **Set up TLS/SSL certificate**. iOS requires that universal links use HTTPS, so a TLS/SSL certificate is required for your email redirect domain.
- **Host AASA file**. iOS requires this file to enable your email redirect domain as a universal link. All email marketing platforms listed below, with the exception of Iterable, require that your CDN host the AASA file. For Iterable, you will upload the AASA file to their system in a later step.
- **Forward traffic**. Except for requests for to AASA file, forward all other traffic to the origin server of your email marketing platform.
- **Configure DNS**. Point your email redirect domain to your CDN. This is usually done by configuring a CNAME record in its DNS settings. This configuration is managed through your domain registrar or web host, depending on which entity controls your DNS. If you're unsure, consult your IT department or system administrator for assistance.
- **Configure domain in email marketing platform**. In the in the email marketing platform dashboard, configure your email redirect domain and ensure that HTTPS support is enabled for it.

Each ESP provides specific setup instructions for different CDN providers. Follow the documentation for your ESP and CDN combination to ensure proper configuration:

| Email marketing platform | CDN setup documentation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Braze                    | Refer to SendGrid or SparkPost, depending on which ESP Braze has assigned to your account.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Customer.io              | [AWS CloudFront](https://docs.customer.io/journeys/https-link-verification/#setting-up-https-link-tracking-with-amazon-cloudfront), [Cloudflare](https://docs.customer.io/journeys/https-link-verification/#cloudflare), [Fastly](https://docs.customer.io/journeys/https-link-verification/#set-up-https-link-tracking-with-fastly-cdn)                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Iterable                 | [AWS CloudFront](https://support.iterable.com/hc/en-us/articles/115000427446-Configuring-HTTPS-for-Link-Tracking-Domains)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Klaviyo                  | [AWS CloudFront](https://help.klaviyo.com/hc/en-us/articles/360052205052#h_01HEANF10B167DHZQJBKKGRH1B), [Cloudflare](https://help.klaviyo.com/hc/en-us/articles/360052205052#h_01HEANF10BCK8MC0E76Y5KPXZR), [Fastly](https://help.klaviyo.com/hc/en-us/articles/360052205052#h_01J29R362ACT5C88K0W4GP95WA)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Mailgun                  | [Cloudflare](https://help.mailgun.com/hc/en-us/articles/360011566033-HTTPS-Tracking-Links)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| SendGrid                 | [AWS CloudFront](https://support.sendgrid.com/hc/en-us/articles/4412701748891-How-to-configure-SSL-for-click-tracking-using-CloudFront), [Cloudflare](https://www.twilio.com/docs/sendgrid/ui/sending-email/content-delivery-networks/using-cloudflare-as-your-content-delivery-network-cdn), [Fastly](https://www.twilio.com/docs/sendgrid/ui/sending-email/content-delivery-networks/using-fastly-as-your-content-delivery-network-cdn), [KeyCDN](https://www.twilio.com/docs/sendgrid/ui/sending-email/content-delivery-networks/using-keycdn-as-your-content-delivery-network-cdn)                                                                                                                                                                                                                  |
| SparkPost                | [AWS CloudFront](https://support.sparkpost.com/docs/tech-resources/enabling-https-engagement-tracking-on-sparkpost/#step-by-step-guide-with-aws-cloudfront), [Cloudflare](https://support.sparkpost.com/docs/tech-resources/enabling-https-engagement-tracking-on-sparkpost/#step-by-step-guide-with-cloudflare), [Fastly](https://support.sparkpost.com/docs/tech-resources/enabling-https-engagement-tracking-on-sparkpost/#step-by-step-guide-with-fastly), [Google Cloud Platform](https://support.sparkpost.com/docs/tech-resources/enabling-https-engagement-tracking-on-sparkpost/#step-by-step-guide-with-google-cloud-platform), [Microsoft Azure](https://support.sparkpost.com/docs/tech-resources/enabling-https-engagement-tracking-on-sparkpost/#step-by-step-guide-with-microsoft-azure) |

#### Create AASA file

To make things easier, you can reuse the AASA file from your Adjust branded domain.

- Download the AASA file from your Adjust branded domain:
   ```
   https://example.go.link/.well-known/apple-app-site-association
   ```
   Replace `example.go.link` with your Adjust branded domain.

##### Email marketing platforms besides Iterable

Host the file on your CDN in this location:

```
https://email.example.com/.well-known/apple-app-site-association
```

Replace `email.example.com` with your email redirect domain.

- Ensure your CDN serves the file according to these requirements:
   - Content-Type header has to be `application/json`.
   - No Content-Disposition header should be present.
   - The server must serve the file directly without redirects
   - The content has to remain in JSON format.

##### Iterable

In the Iterable dashboard, upload the AASA file when [configuring the email redirect domain](https://support.iterable.com/hc/en-us/articles/115002651226-Configuring-Deep-Links-for-Email-or-SMS#setting-up-destination-domains).

### 3. Configure Associated Domains

Add the email redirect domain to your [**Associated Domains** configuration](/en/sdk/ios/features/deep-links/configure-deep-link-settings#configure-universal-links) in Xcode. Example:

`applinks:email.example.com`

### 4. Implement Link Resolution

Add Link Resolution to your [direct deep linking](/en/sdk/ios/features/deep-links/direct) implementation in front of where you are calling `processAndResolve(_:withCompletionHandler:)`.

Add your email redirect domain to `resolveUrlSuffixArray`.

<Tabs>
<Tab title="Swift" sync="swift">

```swift {1-7, 23-24}
// Resolve email redirect
ADJLinkResolution.resolveLink(
  with: incomingLink,
  resolveUrlSuffixArray: ["email.example.com"],
  callback: { resolvedLink in
    // Handle failure if resolvedLink is nil
    guard let resolvedLink = resolvedLink else { return }

    // Create deep link object
    guard let deeplink = ADJDeeplink(deeplink: resolvedLink) else { return }

    // Send deep link to Adjust's servers for attribution.
    // If short branded link, receive long link.
    // Otherwise, receive original link.
    Adjust.processAndResolve(deeplink) { resolvedLink in
      // Handle failure if resolvedLink is nil
      guard let resolvedLink = resolvedLink else { return }

      // TO DO: Handle resolvedLink by parsing its components
      // (example: path, query parameters) and
      // navigating to the appropriate screen.
    }
  }
)
```

</Tab>
<Tab title="Objective-C" sync="objc">

```objc {1-8, 24}
// Resolve email redirect
[ADJLinkResolution resolveLinkWithUrl:incomingLink
                resolveUrlSuffixArray:@[@"email.example.com"]
                            callback:^(NSURL *resolvedLink) {
    // Handle failure if resolvedLink is nil
    if (!resolvedLink) { return; }

    // Create deep link object
    ADJDeeplink *deeplink = [[ADJDeeplink alloc] initWithDeeplink:resolvedLink];
    if (!deeplink) { return; }

    // Send deep link to Adjust's servers for attribution.
    // If short branded link, receive long link.
    // Otherwise, receive original link.
    [Adjust processAndResolveDeeplink:deeplink
                           callback:^(NSURL *resolvedLink) {
        // Handle failure if resolvedLink is nil
        if (!resolvedLink) { return; }

        // TO DO: Handle resolvedLink by parsing its components
        // (example: path, query parameters) and
        // navigating to the appropriate screen.
    }];
}];
```

</Tab>
</Tabs>

### 5. Test and Release

- Create a debug build of your app, and install it on a real iOS device.
- In the Adjust dashboard, create a [custom link](https://help.adjust.com/en/article/custom-link-setup). For email, you generally have to use long links, so that your email marketing platform can populate the attribution parameters (adj_campaign, adj_adgroup, adj_creative) with its macros.
- Create an email template which uses the Adjust deep link.
- Generate a test email from the email template. This should replace the Adjust deep link in the email with an email redirect link.
- Send the test email to an account that can open the email on your real iOS device.
- Open the email in an email app (Gmail, Apple Mail).
- Click the link. The app should open immediately without first opening a browser, and the app should navigate to the correct page. Follow the [testing guide](http://localhost:4321/en/sdk/ios/features/deep-links/testing#test-direct-deep-linking) to test the link when the app is both in not running and background states.
- Release the app update to the App Store.
