---
title: リンクのresolution（解析と変換）
description: メール、SMS、QRコード、リンクを短縮するプラットフォームを介したディープリンクのリンク解析を設定します。
slug: ja/sdk/ios/features/deep-links/resolution
sidebar-position: 5
versions:
   - label: v5
     value: v5
     default: true
   - label: v4
     value: v4
redirects:
   v4: /ja/sdk/ios/v4/features/deep-links/resolution
---

メール、SMS、QRコード、リンクを短縮するプラットフォームを介したディープリンクのリンク解析を設定する必要があります。そのようなケースのためにリンク解析を設定しない場合、ユニバーサルリンクからのリダイレクトでは、アプリをインストールしているユーザーを含めた全てのユーザーがApp Storeに誘導されます。リンク解析が有効な場合、ユニバーサルリンクへのリダイレクトはアプリ内で発生し、既存のユーザーはApp Storeに誘導されません。

<Callout type="note">

リンク解析がアプリに必要かどうか、マーケティングチームに確認してください。その後、各ユースケースに合わせてリンク解析ドメインを設定できます。

</Callout>

## 仕組み {#how-it-works}

リンク解析は、アプリをインストールしているユーザーがリダイレクトURLをクリックしたときにのみ実行されます。リダイレクトURL内のドメインを、アプリ内のユニバーサルリンクドメインとして設定する必要があります。

リンク解析は次のように機能します。

1. 既存のユーザーがリダイレクトリンクをクリックすると、iOSでアプリが開きます。

2. アプリがリダイレクトURLをAdjust SDKの`resolveLinkWithUrl`リンク解析メソッドにパスします。

3. Adjust SDKのリンク解析メソッドで、リダイレクトURL内のドメインと開発者がAdjust SDKで設定したリンク解析ドメインが比較され、次のいずれかが実行されます。

   - ドメインが一致しない \- メソッドはディープリンクURLをそのまま転送します。
   - ドメインが一致する \- メソッドはリンクを解析し、結果のディープリンクを返します。

   URLの解析を試みると、Adjust SDKは最大10のリダイレクトをフォローアップします。リダイレクトが10以上ある場合は、10番目のリダイレクトURLが返されます。

4. アプリは返されたURLを受け取り、ディープリンクコンテンツを開いてユーザーに表示します。またアプリは、返されたURLを使用してAdjust SDKの`processDeeplink`メソッドを呼び出します。これにより、解析されたURLが記録のためにAdjustサーバーに送られます。

<Callout type="note">

アプリをインストールしていないユーザーがリダイレクトURLをクリックした場合、iOSはこれを通常のWeb URLとして処理し、ユーザーをApp Storeにリダイレクトします。この場合、リンク解析は実行されません。

</Callout>

## ユースケース {#use-cases}

リンク解析は、次の場合に実行されます。

- [Eメールマーケティング](#email-marketing)
- [URLを短縮するプラットフォーム](#url-shorteners)

### Eメールマーケティング {#email-marketing}

メールマーケターがキャンペーンを実施する際、メールマーケティングプラットフォームでは通常、独自のクリック計測用リダイレクトURLを使用してメール内の全てのリンクをラップします。これによりメールマーケターは、メールマーケティングプラットフォームでクリック率を確認できます。ただし、メールにユニバーサルリンクが含まれている場合、リダイレクトURLが原因でiOSはユニバーサルリンクを解析できません。

- メールマーケティングプラットフォーム：メールマーケターがキャンペーンを構築するために使用するソフトウェア。これには、メールテンプレートやオーディエンスターゲティングなどの機能が含まれます。 **例：** Braze、Iterable、SendGrid
- メールサービスプロバイダー（ESP）：メールを送信し、ISP（インターネットサービスプロバイダー）のメールサーバーへの送達可能性を管理する基盤インフラストラクチャー。 **例：** SendGrid、SparkPost
- メールパートナー：メールマーケティングプラットフォームまたはメールサービスプロバイダー（ESP）のいずれかを表す一般的な用語。メールパートナーとは、メールマーケティングプラットフォーム、ESP、またはその両方を指します。 **例：** SendGridはメールマーケティングプラットフォームであり、ESPでもあります。メールマーケティングでは、他のパートナーをESPとして使用することができます。 **例：** BrazeとIterableはどちらもSendGridとSparkPostをESPとして使用しています。

#### {#setup} の設定

1. 使用しているドメイン上に、メール計測専用のドメインまたはサブドメインを作成します。メール計測用のドメインまたはサブドメインがすでにある場合は、既存のキャンペーンを妨げることなくこの実装を完了できるよう、新たに作成することをお勧めします。この実装を完了してテストした後に、この実装を既存のメールリダイレクトドメインに切り替えることができます。

   **例：** `email.example.com`

2. Xcodeで、メールリダイレクトドメインを **Associated Domains** 設定に追加します。

   **例：** `applinks:email.example.com`

3. ユニバーサルリンクを設定します。

4. `resolveLinkWithUrl`リンク解析メソッドの`resolveUrlSuffixArray`にメールリダイレクトドメインが追加されていることを確認します。

5. メールマーケティングプラットフォーム/ESPを使用して、メールリダイレクトドメインをカスタム計測ドメインとして設定します。

6. メールリダイレクトドメインへの受信リクエストを処理するために、Amazon CloudFront、CloudFlare、Fastlyなどのコンテンツ配信ネットワーク（CDN）を設定します。CDNで、以下を設定してください。

   1. **SSL証明書** ：iOSでは、ユニバーサルリンクでHTTPSのみを使用する必要があります。そのため、メールリダイレクトドメインにはSSL証明書が必要です。
   2. **AASA（Apple\-App\-Site\-Association）ファイル** ：メールパートナーによっては、独自のAASAファイルをホストするか、AASAファイルをメールパートナーシステムにアップロードする必要があります。AASAファイルのホスティングについては、メールパートナーのドキュメントを参照してください。

   次のパスでホストされているユニバーサルリンクのAASAファイルをダウンロードすることができます：`https://example.go.link/.well-known/apple-app-site-association`。ドメインはユニバーサルリンクドメインに置き換えてください。それから、AdjustユニバーサルリンクのAASAファイルをコピーし、メールリダイレクトドメインのAASAファイルに使用してください。独自のAASAファイルをホストすることをメールパートナーが求めている場合、CDNではメールリダイレクトドメイン上の対応するパスからそのファイルを提供する必要があります \- `https://email.example.com/.well-known/apple-app-site-association`

   3. （該当する場合、AASAファイルを除いた）メールリダイレクトドメインへの全てのリクエストをメールパートナーのリダイレクトサーバーにポイントします。

   **例：** `redirect.example.net`

7. CDNをポイントするようにメールリダイレクトドメインのDNSを設定します。

<Callout>

上記の指示に対応するパートナー固有の指示については、ヘルプセンターの[ESP連携に関するセクション](https://help.adjust.com/ja/marketer/esp-integrations)を参照してください。

</Callout>

##### メールパートナーのサポート {#support-for-email-partners}

リンク解析を使用するには、リダイレクトドメイン（またはサブドメイン）をユニバーサルリンクドメインとして設定することをメールパートナーが許可している必要があります。許可されている場合、それらのリダイレクトサービスを独自のカスタムドメインにポイントできます。

**例：**

- Braze：割り当てられているESP Brazeに応じて、SendGridまたはSparkPostでリダイレクトドメインを設定し、独自のカスタムドメインをそれにポイントします。その後、カスタムドメインをユニバーサルリンクドメインとして設定できます。
- Iterable：Iterableでは、カスタムドメインをサポートするURLリダイレクトサービスが提供されています。
- Mailchimp：Mailchimpでは、リダイレクトドメインをユニバーサルリンクとして設定することが許可されていないため、リンク解析は利用できません。

#### 例 {#example}

1. メールマーケターが、テンプレートを使用してメールを作成します。このテンプレートには、ユニバーサルリンクを使用したリンクまたは画像が含まれています。

   **例：** `https://example.go.link/summer-clothes?promo=beach&adj_t=abc123`

2. 受信者リストに対して、メールを送信します。メールが送信される前に、メールマーケティングプラットフォームは、独自のリダイレクトURLを使用してユニバーサルリンクをラップします。

   **例：** `https://email.example.com/2wuTnQvU`

3. アプリをインストールしたユーザーが、メール内のリダイレクトURLをクリックします。

4. iOSがアプリを開き、リダイレクトURLをアプリにパスします。

5. アプリがリダイレクトURLをAdjust SDKのリンク解析メソッドにパスします。

6. Adjust SDKがアプリ内からリダイレクトURLを解析します。

   したがって、 `https://email.example.com/2wuTnQvU` は
   `https://example.go.link/summer-clothes?promo=beach&adj_t=abc123`にリダイレクトされます。

7. リンク解析メソッドが、解析されたURLを返します。

8. アプリが、返されたURLを処理します。この場合、アプリは`summer-clothes`ページをアプリ内に`beach promo`モーダルでユーザーに表示します。

9. アプリは返されたURLでAdjust SDKの`processDeeplink`メソッドを呼び出します。

### URL短縮 {#url-shorteners}

マーケターが特定の種類のキャンペーンを実施する際、短いURLが必要になる場合があります。例えば、SMSには160文字の制限がありますが、リンクを短縮してSlackなどのチームコミュニケーションプラットフォームで共有することを顧客が望む場合があります。ただし、短縮URLがユニバーサルリンクにリダイレクトされる場合、iOSはユニバーサルリンクを解析できません。

#### {#setup-1} の設定

1. 使用しているドメイン上に、URL短縮専用のドメインまたはサブドメインを作成します。
   URL短縮用のドメインまたはサブドメインがすでにある場合は、既存のキャンペーンを妨げることなくこの実装を完了できるよう、新たに作成することをお勧めします。この実装を完了してテストした後に、この実装を既存のURL短縮ドメインに切り替えることができます。

2. XcodeでURL短縮ドメインを **Associated Domains** 設定に追加します。

   **例：** `applinks:short.example.com`

3. ユニバーサルリンクを設定します。

4. `resolveLinkWithUrl`リンク解析メソッドの`resolveUrlSuffixArray`にメールリダイレクトドメインが追加されていることを確認します。

5. ユニバーサルリンクをサポートするURL短縮サービスを設定します。AdjustではURL短縮サービスを提供していません。

   **例：** [`short.io`](http://short.io)

6. URL短縮サービスで、URL短縮ドメインをカスタムドメインとして設定します。URL短縮サービスのサーバーをポイントするように、URL短縮ドメインのDNSを設定してください（[short.ioにカスタムドメインを追加する参照ドキュメント](https://help.short.io/en/articles/9991681-how-can-i-add-a-domain)）。

7. URL短縮サービスでユニバーサルリンクを設定します（[short.ioのユニバーサルリンクを設定する参照ドキュメント](https://help.short.io/en/articles/4065870-how-to-set-up-deep-links-for-ios)）。

#### 例 {#example-1}

1. マーケターがユニバーサルリンクを作成します。

   **例：** `https://example.go.link/summer-clothes?promo=beach&adj_t=abc123`

2. URL短縮サービスを使用して、短縮リンクを生成します。

   **例：** `https://short.example.com/2wuTnQvU`

3. SMSキャンペーンなどのキャンペーンで短縮リンクを使用します。

4. アプリをインストールしたユーザーが、SMSメッセージ内の短縮URLをクリックします。

5. iOSがアプリを開き、短縮URLをアプリにパスします。

6. アプリが短縮URLをAdjust SDKのリンク解析メソッドにパスします。

7. Adjust SDKがアプリ内から短縮URLを解析します。

   したがって、 `https://short.example.com/2wuTnQvU` は
   `https://example.go.link/summer-clothes?promo=beach&adj_t=abc123`にリダイレクトされます。

8. リンク解析メソッドが、解析されたURLを返します。

9. アプリが、返されたURLを処理します。この場合、アプリは`summer-clothes`ページをアプリ内に`beach promo`モーダルでユーザーに表示します。

10.   アプリは返されたURLでAdjust SDKの`processDeeplink`メソッドを呼び出します。
