---
title: "Cocos2d-x SDK 連携ガイド"
description: "Web SDKを使用して、Cocos2d-xアプリでAdjustの機能にアクセスしましょう。"
category-title: "Cocos2d-x SDK"
slug: "en/sdk/cocos2dx"
sidebar-position: 7
versions: 
    - 
        label: "v5"
        value: "v5"
        default: true
    - 
        label: "v4"
        value: "v4"
redirects: 
    v4: "/en/sdk/cocos2dx/v4"
---
AdjustのAndroid SDKを実装することで、アトリビューション、イベント、さらにその他のさまざまなデータをCocos2d\-xアプリで記録できます。Adjust SDKをアプリに実装するには、以下の手順に従ってください。

1\. SDKをインストールする \{% \#install\-the\-sdk %\}
--------------------------------------------------

SDK v5の使用を開始するには、プロジェクトにdependencyとしてSDK v5を追加する必要があります。これを行うには、以下の手順に従ってください。

1. [GitHubから](https://github.com/adjust/cocos2dx_sdk/releases)SDKアーカイブをダウンロードします。

2. `dist`ディレクトリからC\+\+ ファイルをコピーし、Cocos2d\-x プロジェクトに追加します。

3. （ **Androidのみ** ）：`Android.mk`ファイルの`LOCAL_SRC_FILES`セクションにC\+\+ファイルのパスを追加します。

   ```text
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustConfig2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustAttribution2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustProxy2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustEvent2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/Adjust2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustEventFailure2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustEventSuccess2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustSessionFailure2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustSessionSuccess2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustAppStoreSubscription2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustPlayStoreSubscription2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustThirdPartySharing2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustAdRevenue2dx.cpp
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustAppStorePurchase2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustPlayStorePurchase2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustDeeplink2dx.cpp \
   $(LOCAL_PATH)/../../../Classes/Adjust/AdjustPurchaseVerificationResult2dx.cpp \
   ```

   CMakeを使用している場合は、`CMakeLists.txt`ファイルに以下のソースとヘッダーのリストを追加します。

   ```cmake
   # add cross-platforms source files and header files
   list(APPEND GAME_SOURCE
       Classes/Adjust/AdjustConfig2dx.cpp
       Classes/Adjust/AdjustAttribution2dx.cpp
       Classes/Adjust/AdjustProxy2dx.cpp
       Classes/Adjust/AdjustEvent2dx.cpp
       Classes/Adjust/AdjustAdRevenue2dx.cpp
       Classes/Adjust/AdjustAppStoreSubscription2dx.cpp
       Classes/Adjust/AdjustPlayStoreSubscription2dx.cpp
       Classes/Adjust/AdjustAppStorePurchase2dx.cpp
       Classes/Adjust/AdjustPlayStorePurchase2dx.cpp
       Classes/Adjust/Adjust2dx.cpp
       Classes/Adjust/AdjustEventFailure2dx.cpp
       Classes/Adjust/AdjustEventSuccess2dx.cpp
       Classes/Adjust/AdjustSessionFailure2dx.cpp
       Classes/Adjust/AdjustSessionSuccess2dx.cpp
       Classes/Adjust/AdjustThirdPartySharing2dx.cpp
       Classes/Adjust/AdjustDeeplink2dx.cpp
       Classes/Adjust/AdjustPurchaseVerificationResult2dx.cpp
       )
   list(APPEND GAME_HEADER
       Classes/Adjust/AdjustConfig2dx.h
       Classes/Adjust/AdjustAttribution2dx.h
       Classes/Adjust/AdjustProxy2dx.h
       Classes/Adjust/AdjustEvent2dx.h
       Classes/Adjust/AdjustAdRevenue2dx.h
       Classes/Adjust/AdjustAppStoreSubscription2dx.h
       Classes/Adjust/AdjustPlayStoreSubscription2dx.h
       Classes/Adjust/AdjustAppStorePurchase2dx.h
       Classes/Adjust/AdjustPlayStorePurchase2dx.h
       Classes/Adjust/Adjust2dx.h
       Classes/Adjust/AdjustEventFailure2dx.h
       Classes/Adjust/AdjustEventSuccess2dx.h
       Classes/Adjust/AdjustSessionFailure2dx.h
       Classes/Adjust/AdjustSessionSuccess2dx.h
       Classes/Adjust/AdjustThirdPartySharing2dx.h
       Classes/Adjust/AdjustDeeplink2dx.h
       Classes/Adjust/AdjustPurchaseVerificationResult2dx.h
       )
   ```

4. （ **Androidのみ** ）：[GitHubのリリースページ](https://github.com/adjust/cocos2dx_sdk/releases/latest)から最新の`adjust-android.aar`をダウンロードし、Android Studioプロジェクトにインポートします。

5. （ **iOSのみ** ）：[GitHubリリースページ](https://github.com/adjust/cocos2dx_sdk/releases/latest)から最新の`AdjustSdk.framework`をダウンロードし、Xcodeプロジェクトにリンクします。

2\. シグネチャーライブラリを設定 \{% \#signature\-setup %\}
--------------------------------------------------

SDK v5は [SDKシグネチャーライブラリ](https://help.adjust.com/en/article/sdk-signature)を使用して、Adjust SDKからAdjustサーバーに送信される情報を暗号化します。SDK v5を使用するには、プロジェクトにシグネチャーライブラリを追加する必要があります。

### Androidアプリ

1. [AdjustシグネチャーライブラリのGitHubリポジトリ](https://github.com/adjust/adjust_signature_sdk/releases/latest)から、最新の`adjust-android-signature.aar`をダウンロードします。
2. Android Studioプロジェクトに`.aar`を追加します。

### iOSアプリ

1. [AdjustシグネチャーライブラリのGitHubリポジトリ](https://github.com/adjust/adjust_signature_sdk/releases/latest)から、最新の`AdjustSigSdk-iOS-Static.a`をダウンロードします。
2. Xcodeプロジェクトに`.a`をリンクします。

3\. Androidを設定 \{% \#android\-settings %\}
-----------------------------------------------

Androidデバイス向けにAdjust SDKを設定するには、以下の手順に従ってください。

### パーミッション \{% \#android\-permissions %\}

Adjust Android SDKには、必要なパーミッションが事前設定されています。これには`com.google.android.gms.permission.AD_ID`パーミッションが含まれます。アプリが児童オンラインプライバシー保護法（COPPA）に準拠する必要がある場合は、以下を`AndroidManifest.xml`ファイルに追加して、このパーミッションを削除する必要があります。

```xml
<uses-permission android:name="com.google.android.gms.permission.AD_ID" tools:node="remove" id="sl-md0000000"/>
```

COPPAの詳細については、 [AdjustのCOPPAコンプライアンスに関する記事](https://help.adjust.com/en/article/coppa-compliance)をご覧ください。

### Google Play 開発者サービスを追加する \{% \#add\-google\-play\-services %\}

Google Playストアを対象とするアプリは、[Google広告ID](https://support.google.com/googleplay/android-developer/answer/6048248?hl=en)（`gps_adid`）を使用してデバイスを識別する必要があります。これを行うには、以下のdependencyを`build.gradle`ファイルの `dependencies`セクションに追加してください。

```groovy
dependencies: {
   implementation 'com.google.android.gms:play-services-ads-identifier:18.1.0'
}
```

### インストールリファラーを設定する \{% \#set\-up\-install\-referrer %\}

インストールリファラーは、アプリインストールをソースにアトリビュートするために使用できるアトリビューションメカニズムです。2つの部分で構成されます。

* アプリ内でリファラルコンテンツを取得するために開発者が使用する、これらのアプリストアの一連のAPI。
* Google PlayやHuawei App Galleryなどのアプリストアが、ストアのWebサイト上のアプリページURLで受け入れる`referrer`パラメーター。リファラーパラメーターの設定方法は以下のとおりです。 
  * ユーザーがAdjustリンクをクリックすると、Adjustサーバーは`reftag`というユニークIDをパスします。このIDはクリックとリファラーパラメーターに割り当てられます。リファレンスタグの詳細については、[ヘルプセンターのリファレンスタグに関する記事](https://help.adjust.com/en/article/reftag)をご覧ください。
  * [Google 広告](https://support.google.com/google-ads/answer/6357635?hl=en)キャンペーンを実行すると、`gclid`というユニークIDがGoogleからリファラーパラメーターにパスされます。Google 広告アカウントで **自動タグ** を有効にしてください。

#### Google Play Referrer API

[Google Play Referrer API](https://developer.android.com/google/play/installreferrer)をサポートするには、以下の手順に従ってください。

1. Google Mavenリポジトリを`build.gradle`ファイルに追加します。

   ```groovy
   allprojects {
      repositories {
         maven {
            url "https://maven.google.com"
         }
      }
   }
   ```

2. インストールリファラーライブラリを`build.gradle`ファイルに追加します。

   ```groovy
   dependencies {
      implementation 'com.android.installreferrer:installreferrer:2.2'
   }
   ```

#### Meta インストールリファラー

Adjust SDKは、Adjust Metaインストールリファラープラグインを使用して[Metaインストールリファラー](https://developers.facebook.com/docs/app-ads/meta-install-referrer)をサポートしています。[連携の詳細については、Cocos2d\-x Metaインストール リファラープラグインをご覧ください](/en/sdk/cocos2dx/plugins/meta-referrer-plugin)。

4\. iOS設定を構成する\{% \#ios\-settings %\}
------------------------------------------

iOSデバイス向けにAdjust SDKを設定するには、以下の手順に従ってください。

### 追加のフレームワークを連携する\{% \#link\-frameworks %\}

以下のフレームワークをXcodeプロジェクトにリンクして、Adjust SDKがデバイスレベルの情報にアクセスできるようにします。

|              Framework              |                                  目的                                  |                         注意                         |
|-------------------------------------|----------------------------------------------------------------------|----------------------------------------------------|
| `AdSupport.framework`               | Adjust SDKがデバイスIDFAを読み取るために必須。                                       | アプリが「子供向け」カテゴリーをターゲットにしている場合、このフレームワークは追加しないでください。 |
| `AdServices.framework`              | Apple Search Adsの処理に必須。                                              |                                                    |
| `StoreKit.framework`                | SKAdNetwork frameworkにアクセスし、Adjust SDKがSKAdNetworkとの通信を処理するために必須。    |                                                    |
| `AppTrackingTransparency.framework` | iOS 14以降で、Adjust SDKがATT同意ダイアログをラップし、ユーザーの同意レスポンスにアクセスできるようにするために必須。 | アプリが「子供向け」カテゴリーをターゲットにしている場合、このフレームワークは追加しないでください。 |

### 追加のソースファイルをコピー\{% \#copy\-source\-files %\}

iOSの設定を完了するには、全てのObjective\-C\+\+（`.h`および`.mm`）ファイルを、解凍したSDKアーカイブの`dist`ディレクトリからXcodeプロジェクトにコピーする必要があります。全ての`.mm`ファイルが **Build Phases \-\-> Compile Sources** セクションに表示されていることを確認してください。

### アプリのプライバシーマニフェストを更新\{% \#update\-privacy\-manifest %\}

App StoreにAdjust SDKのプライバシー要件を通知するには、プライバシーマニフェストをAdjustのプライバシーマニフェストとマージする必要があります。

1. アプリのプライバシーマニフェストに[Adjust SDKプライバシーマニフェスト](https://github.com/adjust/ios_sdk/blob/master/Adjust/PrivacyInfo.xcprivacy)のプロパティを追加します。
2. アプリのプライバシーマニフェストに、[シグネチャーライブラリのプライバシーマニフェスト](https://github.com/adjust/adjust_signature_sdk/blob/main/Resources/iOS/PrivacyInfo.xcprivacy)からプロパティを追加します。

6\. Adjust SDKを実装する \{% \#integrate\-the\-adjust\-sdk %\}
----------------------------------------------------------------

プロジェクトの設定を更新したら、Adjust SDKをアプリに実装することができます。これを行うには、以下の手順に従ってください。

1. **Project Navigator** でアプリケーションデリゲートファイルを探し、開きます。

2. ファイルの最上部に`Adjust/Adjust2dx.h`クラスを追加します。

3. 以下の引数で`AdjustConfig2dx`をインスタンス化します：

   \{% deflist %\}
   `appToken` \(`std::string`\)

   : Adjustアプリトークン

   `environment` （`std::string`）

   : サンドボックス環境でアプリをテストするには、 `AdjustEnvironmentSandbox2dx`をパスします。
   \{% /deflist %\}
4. 任意で[ログレベル](/en/sdk/cocos2dx/configuration#set-your-logging-level)を変更し、ログの詳細度を調整することができます。

5. アプリが起動したらすぐに、 `Adjust2dx::initSdk`メソッドを呼び出し、 `AdjustConfig2dx`インスタンスを引数としてパスします。

\{% callout type="important" %\}
テストを実施する際は、環境が`AdjustEnvironmentSandbox2dx`に設定されているようにしてください。アプリをアプリストアに提出する前に、これを`AdjustEnvironmentProduction2dx`に変更してください。
\{% /callout %\}

```cpp
#include "Adjust/Adjust2dx.h"

std::string appToken = "{% $variables.config.token %}";
std::string environment = AdjustEnvironmentSandbox2dx;

AdjustConfig2dx adjustConfig = AdjustConfig2dx(appToken, environment);
adjustConfig.setLogLevel(AdjustLogLevel2dxVerbose);
Adjust2dx::initSdk(adjustConfig);
```

7\. アプリをビルドする \{% \#build\-your\-app %\}
----------------------------------------------

設定が完了しました。これで、Cocos2d\-xアプリのビルドと実行が可能になりました。ログを有効にして、問題がないか確認してください。ログを確認して、`Install tracked`メッセージがあるか調べます。

Adjust SDKを使用してユーザーをアトリビューションできるようになりました。

