---
title: サーバー間（S2S）セキュリティ
description: Adjustのサーバー間（S2S）セキュリティー機能を使用することで、S2Sイベントのセキュリティを保証し、不正リクエストを防止することができます。
slug: ja/api/s2s-api/security
sidebar-position: 1
sidebar-label: S2Sセキュリティ
---

Adjustのサーバー間（S2S）セキュリティー機能を使用することで、S2Sイベントのセキュリティを保証し、不正リクエストを防止することができます。各S2S認証のリクエストには、Adjustダッシュボードで生成されたトークンを含める必要があります。有効なトークンが含まれていないリクエストは、Adjustのサーバーによって拒否されます。

## 事前準備 \{\#before\-you\-begin\}

はじめに、以下の設定手順をご覧ください。

<Callout type="warning">

S2Sセキュリティは、Google タグ マネージャーのイベント計測に対応していません。Google タグ マネージャーの設定でAdjustのS2S認証トークンを使用すると、 Googleタグ マネージャーより受信するイベントが拒否されます。

</Callout>

### 要件 {#requirements}

- [管理者のアスセス権限](https://help.adjust.com/ja/article/permission-levels)

## S2Sトークンを作成する \{\#create\-an\-s2s\-token\}

少なくとも1つのトークンを設定し、その **スコープ（範囲）** を指定する必要があります。スコープは、トークンを使用して実行できるアクションを定義します。以下のスコープが利用できます。

- **イベント** ：イベントデータを送信する機能を付与します。
- **セッション** ：セッションデータを送信する機能を付与します。
- **広告収益** ：広告収益データを送信するための機能を付与します。
- **GDPR** ：GDPRエンドポイントを認証する機能を付与します。GDPRのスコープはトークンの作成では利用できませんが、[S2S認証を有効化（Enable S2S authentication）](#enable-s2s-authentication)のセクションで設定できます。

スコープ付きトークンを新規作成する方法：

1. **AppView** で **全てのアプリ（All apps）** を選択します。

2. アプリを選択します。

3. **不正防止（Protection）** タブを選択します。

4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。

   ![AdjustのS2Sセキュリティページ](@images/s2s/1-s2s-security.png)

5. **\+ 新規トークン（New token）** を選択します。モーダルが表示されます。

6. 表示されるモーダルで、トークンの **トークン名** を入力します。

   ![「新規トークンを追加」モーダル](@images/s2s/2-add-token-modal.png)

7. トークンに割り当てる範囲を **スコープ（Scope）** ドロップダウンから選択します。各トークンに対して複数のスコープを選択できます。

   ![範囲が選択されたトークンモーダル](@images/s2s/3-token-scope-modal.png)

8. **トークンを追加（Add token）** を選択して、トークンを保存します。

9. **トークンをコピーして閉じる（Copy token and close）** を選択して、トークンをコピーします。 これを開発者に送信し、S2Sアプリのリクエストに追加してください。

   ![「トークンをコピーして閉じる」オプションのあるモーダル](@images/s2s/4-copy-token.png)

各トークンのスコープは、トークンリストに表示されます。

**S2S認証を有効化（Enable S2S authentication）** トグルは、デフォルトで **OFF** になっています。S2S認証を有効化するには、次のセクションの手順に従ってください。

## S2S認証を有効化する\{\#enable\-s2s\-authentication\}

<Callout type="important">

開発者がトークンの実装をテストし、テクニカルアカウントマネージャーまたは[support@adjust.com](mailto:support@adjust.com)が設定を確認した後に、S2S認証を有効化してください。

</Callout>

スコープを指定したトークンを追加したら、選択したスコープエンドポイントに対してS2S認証を有効化する必要があります。S2S認証を有効化するには、以下の手順に従ってください。

1. **AppView** で **全てのアプリ（All apps）** を選択します。

2. アプリを選択します。

3. **不正防止（Protection）** タブを選択します。

4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。

5. 少なくとも1つのトークンが設定済みであることを確認します。

6. **S2S認証を有効化（Enable S2S authentication）** トグルをを **ON** に切り替えます。

7. （オプション）認証するエンドポイントを選択することで、認証スコープをカスタマイズすることもできます。

   ![An authentication scopes modal with scopes selected](@images/s2s/7-select-authentication-scopes.png)

8. **適用（Apply）** を選択します。

**スコープをカスタマイズ（Customize scopes）** を選択することで、いつでも認証スコープを変更できます。

## スコープ付きトークンを変更する \{\#modify\-a\-scoped\-token\}

既存のトークンのスコープを変更するには、以下の手順に従ってください。

1. **AppView** で **全てのアプリ（All apps）** を選択します。

2. アプリを選択します。

3. **不正防止（Protection）** タブを選択します。

4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。

5. リストでトークンを見つけ、編集アイコンを選択します。

6. **スコープ（Scope）** ドロップダウンより、スコープを追加または削除します。

7. **トークンを編集（Edit token）** を選択して、変更を保存します。

   ![範囲のリストとトークンを表示するモーダル](@images/s2s/6-scoped-token-edit.png)

これ以降、受信するS2Sリクエストは全てアクティブな認証トークンが付与されている必要があります。以前にスコープを設定せずにトークンを設定した場合、これらは **全て** のエンドポイントに対して引き続き動作します。セキュリティを強化するためには、スコープ付きトークンを使用することを推奨します。

## 承認リクエストの例 \{\#example\-authenticated\-request\}

```console
curl -v -X \
POST -H \
"Authorization: Bearer v8s5opi0zs45607l8h8c48wak2vxb5oe" \
"https://s2s.adjust.com/event?s2s=1&app_token=abc123kuvada7&event_token=xyzklm&gps_adid=11110111-2345-6789-1122-000000005678"
```

```text
> POST /event?s2s=1&app_token=abc123kuvada7&event_token=xyzklm&gps_adid=11110111-2345-6789-1122-000000005678 HTTP/1.1
> Host: s2s.adjust.com
> User-Agent: curl/7.54.0
> Accept: */*
> Authorization: Bearer v8s5opi0zs45607l8h8c48wak2vxb5oe
```

リクエストは以下のいずれかのレスポンスを返します。

| レスポンスコード | レスポンスメッセージ         | 理由                                                                                                                                 |
| ---------------- | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `200`            | OK                           | リクエストが受理されました。                                                                                                         |
| `202`            | Missing authentication token | リクエストにトークンが追加されていません。                                                                                           |
| `202`            | Wrong authentication token   | トークンは追加されていますが認識されません。<br />トークンが正しく設定され、アクティブであることをダッシュボードで確認してください。 |
| `401`            | Session failed               | このリクエストには認証スコープが不足していました。                                                                                   |

## トークンを管理する \{\#manage\-your\-tokens\}

複数の認証トークンを追加するには、[上記と同じ設定手順に従ってください。](#activate-s2s-authentication)

<Callout type="note">

実装後も常にトークンをテストしてください。S2S認証が有効化されている場合、新しいトークンが正しく実装されていないリクエストは拒否されます。

</Callout>

不要になったトークンは、 **非アクティブ** にすることができます。

1. **AppView** で **マイアプリ（My apps）** を選択します。
2. アプリを選択します。
3. **不正防止（Protection）** タブを選択します。
4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。
5. トークンを見つけて、そのトグルを **OFF** にします。

<Callout type="important">

全てのトークンを非アクティブにした場合、Adjustは自動的にS2S認証を無効化します。これによって、全てのS2Sトラフィックを拒否しないようにします。

</Callout>

トグルの位置を **ON** にスライドさせることで、いつでも非アクティブなトークンを再有効化させることができます。もしくは、 **非アクティブなトークンを表示する（Show inactive tokens）** のトグルをOFFにすることで、非表示にできます。

S2S認証を無効化するには、 **S2S認証がON：不正から保護されています（S2S authentication is ON: you’re protected against fraud）** というラベルのトグルを無効にします。警告モーダルが表示されます。S2S認証を無効化するには、 **OFF** を選択してください。
