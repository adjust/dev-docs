---
title: "サーバー間（S2S）セキュリティ"
description: "Adjustのサーバー間（S2S）セキュリティー機能を使用することで、S2Sイベントのセキュリティを保証し、不正リクエストを防止することができます。"
slug: "ja/api/s2s-api/security"
sidebar-position: 1
sidebar-label: "S2Sセキュリティ"
---

Adjustのサーバー間（S2S）セキュリティー機能を使用することで、S2Sイベントのセキュリティを保証し、不正リクエストを防止することができます。S2S認証の設定後は、受信するリクエストごとに、Adjustダッシュボードで生成されたトークンが付与されている必要があります。有効なトークンが付与されていないリクエストは、Adjustのサーバーによって拒否されます。

## 事前準備 {#before-you-begin}

はじめに、以下の設定手順をご覧ください。

<Callout type="warning">

S2Sセキュリティは、Google タグ マネージャーのイベント計測に対応していません。Google タグ マネージャーの設定でAdjustのS2S認証トークンを使用すると、 Googleタグ マネージャーより受信するイベントが拒否されます。

</Callout>

### 要件 {#requirements}

-  [管理者のアスセス権限](https://help.adjust.com/ja/article/permission-levels)

## S2Sトークンを作成 {#create-an-s2s-token}

<Callout type="important">

S2S認証を有効化するには、少なくとも1つのトークンを設定する必要があります。

</Callout>

1. **AppView** で **全てのアプリ（All apps）** を選択します。
2. アプリを選択します。
3. **不正防止（Protection）** タブを選択します。
4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。
5. **トークンを追加（Add token）** を選択します。
6. トークン名を入力し、 **トークンを追加（Add token）** を選択します。
7. コピーアイコンを選択してトークンをコピーし、開発者に送信して、S2Sイベントのリクエストを追加します。
8. テストを実行して、連携を確認するよう開発者に依頼します。

この時点では、S2S認証は有効ではなく、無効なトークンが付与されたリクエストはまだ受理されます。S2S認証を有効化する前に、専任のテクニカルアカウントマネージャーまたは[support@adjust.com](mailto:support@adjust.com)に連絡し、設定に問題がないか確認してください。

## トークンスコープ {#token-scopes}

S2S認証が有効化されている場合は、各トークンの **スコープ（範囲）** を指定する必要があります。スコープは、トークンを使用してどのようなアクションを実行できるかを定義します。以下のスコープを設定することが可能です：

-  **イベント** ：イベントデータを送信する機能を付与します。
-  **セッション** ：セッションデータを送信する機能を付与します。
-  **広告収益** ：広告収益データを送信するための機能を付与します。

### スコープ付きトークンを作成 {#create-a-scoped-token}

スコープ付きトークンを新規作成する方法：

1. **AppView** で **全てのアプリ（All apps）** を選択します。

2. アプリを選択します。

3. **不正防止（Protection）** タブを選択します。

4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。

   ![AdjustのS2Sセキュリティページ](@images/s2s/1-s2s-security.png)

5. **トークンを追加（Add token）** を選択します。モーダルが表示されます。

6. 表示されるモーダルで、トークンの **トークン名** を入力します。

   ![「新規トークンを追加」モーダル](@images/s2s/2-add-token-modal.png)

7. トークンに割り当てる範囲を **スコープ（Scope）** ドロップダウンから選択します。各トークンに対して複数のスコープを選択できます。

   ![範囲が選択されたトークンモーダル](@images/s2s/3-token-scope-modal.png)

8. **トークンを追加（Add token）** を選択して、トークンを保存します。

9. **トークンをコピーして閉じる（Copy token and close）** を選択して、トークンをコピーします。これを開発者に送信し、S2Sアプリのリクエストに追加してください。

   ![「トークンをコピーして閉じる」オプションのあるモーダル](@images/s2s/4-copy-token.png)

各トークンのスコープは、トークンリストに表示されます。

![対象となるトークンのリスト](@images/s2s/5-scoped-token-list.png)

### スコープ付きトークンを変更する {#modify-a-scoped-token}

既存のトークンのスコープを変更するには、以下の手順に従ってください。

1. **AppView** で **全てのアプリ（All apps）** を選択します。

2. アプリを選択します。

3. **不正防止（Protection）** タブを選択します。

4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。

5. リストでトークンを見つけ、編集アイコンを選択します。

   ![インライン編集ボタンのあるトークンのリスト](@images/s2s/5-scoped-token-list.png)

6. **スコープ（Scope）** ドロップダウンより、スコープを追加または削除します。

7. **トークンを編集（Edit token）** を選択して、変更を保存します。

   ![範囲のリストとトークンを表示するモーダル](@images/s2s/6-scoped-token-edit.png)

## S2S認証を有効化する {#activate-s2s-authentication}

<Callout type="important">

開発者がトークンの実装をテストし、テクニカルアカウントマネージャーまたは[support@adjust.com](mailto:support@adjust.com)が設定を確認した後に、S2S認証を有効化してください。

</Callout>

S2S認証を有効化するには、以下の手順に従ってください。

1. **AppView** で **全てのアプリ（All apps）** を選択します。
2. アプリを選択します。
3. **不正防止（Protection）** タブを選択します。
4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。
5. 少なくとも1つのトークンが設定済みであることを確認します。
6. トグルを **ON** に切り替えます。警告メッセージが表示され、設定されたトークンで送信されたリクエストのみが動作することを通知します。
7. **ON** を選択して次に進みます。

これ以降、受信するS2Sリクエストは全てアクティブな認証トークンが付与されている必要があります。以前にスコープを設定せずにトークンを設定した場合、これらは **全て** のエンドポイントに対して引き続き動作します。セキュリティを強化するためには、スコープ付きトークンを使用することを推奨します。

## 承認リクエストの例 {#example-authenticated-request}

```console
curl -v -X \
POST -H \
"Authorization: Bearer v8s5opi0zs45607l8h8c48wak2vxb5oe" \
"https://s2s.adjust.com/event?s2s=1&app_token=abc123kuvada7&event_token=xyzklm&gps_adid=11110111-2345-6789-1122-000000005678"
```

```text
> POST /event?s2s=1&app_token=abc123kuvada7&event_token=xyzklm&gps_adid=11110111-2345-6789-1122-000000005678 HTTP/1.1
> Host: s2s.adjust.com
> User-Agent: curl/7.54.0
> Accept: */*
> Authorization: Bearer v8s5opi0zs45607l8h8c48wak2vxb5oe
```

リクエストは以下のいずれかのレスポンスを返します。

| レスポンスコード | レスポンスメッセージ         | 理由                                                                                                                                 |
| ---------------- | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `200`            | OK                           | リクエストが受理されました。                                                                                                         |
| `202`            | Missing authentication token | リクエストにトークンが追加されていません。                                                                                           |
| `202`            | Wrong authentication token   | トークンは追加されていますが認識されません。<br />トークンが正しく設定され、アクティブであることをダッシュボードで確認してください。 |

## トークンの管理 {#manage-your-tokens}

複数の認証トークンを追加するには、[上記と同じ設定手順に従ってください。](#activate-s2s-authentication)

<Callout type="note">

実装後も常にトークンをテストしてください。S2S認証が有効化されている場合、新しいトークンが正しく実装されていないリクエストは拒否されます。

</Callout>

不要になったトークンは、 **非アクティブ** にすることができます。

1. **AppView** で **マイアプリ（My apps）** を選択します。
2. アプリを選択します。
3. **不正防止（Protection）** タブを選択します。
4. **サーバー間 \(S2S\) セキュリティ（S2S Security）** セクションで、 **S2Sセキュリティを開く（Open S2S Security）** を選択します。
5. トークンを見つけて、そのトグルを **OFF** にします。

<Callout type="important">

全てのトークンを非アクティブにした場合、Adjustは自動的にS2S認証を無効化します。これによって、全てのS2Sトラフィックを拒否しないようにします。

</Callout>

トグルの位置を **ON** にスライドさせることで、いつでも非アクティブなトークンを再有効化させることができます。もしくは、 **非アクティブなトークンを表示する（Show inactive tokens）** のトグルをOFFにすることで、非表示にできます。

S2S認証を非アクティブにするには、 **S2S認証がON：不正から保護されています（S2S authentication is ON: you’re protected against fraud）** を非有効化します。警告メッセージが表示されます。 **OFFにする（Turn off）** を選択して、S2S認証を非アクティブにします。
